<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="/static/favicon.ico" type="image/x-icon" />    
    <title>SLEMP Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <style>
        .fullscreen-editor {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            max-width: none !important;
            margin: 0 !important;
            z-index: 9999 !important;
            border-radius: 0 !important;
        }
        
        .editor-toolbar {
            border-bottom: 1px solid #e5e7eb;
        }
        
        .dark .editor-toolbar {
            border-bottom-color: #4b5563;
        }
        
        .editor-action-btn {
            transition: all 0.2s ease;
        }
        
        .editor-action-btn:hover {
            transform: translateY(-1px);
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 transition-colors duration-200">
    <div class="min-h-screen">
        <nav class="bg-white dark:bg-gray-800 shadow-lg transition-colors duration-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex">
                        <div class="flex-shrink-0 flex items-center">
                            <img src="{{ url_for('static', filename='logo.png') }}" alt="SLEMP Logo" class="h-8 w-8 mr-3">
                            <h1 class="text-lg sm:text-xl font-bold text-gray-900 dark:text-white">SLEMP Panel</h1>
                        </div>
                        <div class="hidden md:ml-6 md:flex md:space-x-8">
                            <button onclick="showSection('dashboard')" class="text-gray-900 dark:text-gray-100 inline-flex items-center px-1 pt-1 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 text-sm font-medium transition-colors duration-200">
                            Dashboard
                        </button>
                        <button onclick="showSection('network')" class="text-gray-900 dark:text-gray-100 inline-flex items-center px-1 pt-1 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 text-sm font-medium transition-colors duration-200">
                            Network
                        </button>
                        <button onclick="showSection('nginx')" class="text-gray-900 dark:text-gray-100 inline-flex items-center px-1 pt-1 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 text-sm font-medium transition-colors duration-200">
                            Nginx
                        </button>
                            <button onclick="showSection('php')" class="text-gray-900 dark:text-gray-100 inline-flex items-center px-1 pt-1 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 text-sm font-medium transition-colors duration-200">
                                PHP-FPM
                            </button>
                            <button onclick="showSection('mysql')" class="text-gray-900 dark:text-gray-100 inline-flex items-center px-1 pt-1 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 text-sm font-medium transition-colors duration-200">
                                MySQL
                            </button>
                            <button onclick="showSection('files')" class="text-gray-900 dark:text-gray-100 inline-flex items-center px-1 pt-1 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 text-sm font-medium transition-colors duration-200">
                                File Manager
                            </button>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <!-- Mobile menu button -->
                        <div class="md:hidden">
                            <button onclick="toggleMobileMenu()" class="text-gray-900 dark:text-gray-100 inline-flex items-center justify-center p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500">
                                <svg id="mobile-menu-icon" class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                                </svg>
                                <svg id="mobile-close-icon" class="h-6 w-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Desktop buttons -->
                        <div class="hidden md:flex md:items-center md:space-x-4">
                        <!-- Theme Toggle Dropdown -->
                        <div class="relative" id="theme-dropdown">
                            <button onclick="toggleThemeDropdown()" id="theme-toggle" class="text-gray-900 dark:text-gray-100 inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                <svg id="theme-icon" class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path id="theme-icon-path" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                </svg>
                                <span id="theme-text">Light</span>
                                <svg class="ml-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="theme-dropdown-menu" class="hidden absolute right-0 mt-2 w-32 bg-white dark:bg-gray-800 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50">
                                <div class="py-1">
                                    <button onclick="setTheme('light')" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600 flex items-center">
                                        <svg class="mr-3 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                        </svg>
                                        Light
                                    </button>
                                    <button onclick="setTheme('dark')" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600 flex items-center">
                                        <svg class="mr-3 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                                        </svg>
                                        Dark
                                    </button>
                                    <button onclick="setTheme('system')" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600 flex items-center">
                                        <svg class="mr-3 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                        </svg>
                                        System
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Actions Dropdown -->
                        <div class="relative" id="actions-dropdown">
                            <button onclick="toggleActionsDropdown()" class="text-gray-900 dark:text-gray-100 inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path>
                                </svg>
                                Actions
                                <svg class="ml-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="actions-dropdown-menu" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50">
                                <div class="py-1">
                                    <button onclick="restartApp(); toggleActionsDropdown()" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600 flex items-center">
                                        <svg class="mr-3 h-4 w-4 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                        </svg>
                                        Reload
                                    </button>
                                    <button onclick="showChangePasswordModal(); toggleActionsDropdown()" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600 flex items-center">
                                        <svg class="mr-3 h-4 w-4 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                                        </svg>
                                        Password
                                    </button>
                                    <div class="border-t border-gray-100 dark:border-gray-600"></div>
                                    <a href="{{ url_for('logout') }}" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600 flex items-center">
                                        <svg class="mr-3 h-4 w-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                        </svg>
                                        Logout
                                    </a>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
                
                <!-- Mobile menu -->
                <div id="mobile-menu" class="hidden md:hidden">
                    <div class="px-2 pt-2 pb-3 space-y-1 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
                        <button onclick="showSection('dashboard'); toggleMobileMenu()" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700">
                            Dashboard
                        </button>
                        <button onclick="showSection('network'); toggleMobileMenu()" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700">
                            Network
                        </button>
                        <button onclick="showSection('nginx'); toggleMobileMenu()" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700">
                            Nginx
                        </button>
                        <button onclick="showSection('php'); toggleMobileMenu()" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700">
                            PHP-FPM
                        </button>
                        <button onclick="showSection('mysql'); toggleMobileMenu()" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700">
                            MySQL
                        </button>
                        <button onclick="showSection('files'); toggleMobileMenu()" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700">
                            File Manager
                        </button>
                        
                        <!-- Mobile Actions -->
                        <div class="border-t border-gray-200 dark:border-gray-700 pt-3 mt-3">
                            <!-- Theme options for mobile -->
                            <div class="px-3 py-2">
                                <p class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Theme</p>
                                <div class="space-y-1">
                                    <button onclick="setTheme('light'); toggleMobileMenu()" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700">
                                        ☀️ Light
                                    </button>
                                    <button onclick="setTheme('dark'); toggleMobileMenu()" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700">
                                        🌙 Dark
                                    </button>
                                    <button onclick="setTheme('system'); toggleMobileMenu()" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700">
                                        💻 System
                                    </button>
                                </div>
                            </div>

                            <button onclick="restartApp()" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700">
                                🔄 Reload
                            </button>
                            <button onclick="showChangePasswordModal()" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700">
                                🔑 Password
                            </button>
                            <a href="{{ url_for('logout') }}" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700">
                                🚪 Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <main class="max-w-7xl mx-auto py-4 px-4 sm:py-6 sm:px-6 lg:px-8">
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="section mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white">System Resources</h2>
                    <div class="flex items-center space-x-2">
                        <svg class="h-5 w-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span class="text-sm font-medium text-gray-600 dark:text-gray-300">Uptime:</span>
                        <span class="text-sm font-semibold text-green-600" id="server-uptime">Loading...</span>
                    </div>
                </div>

                
                <!-- Real-time System Resources Chart -->
                <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg mt-6 transition-colors duration-200">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4">Real-time System Resources (%)</h3>
                        <div id="system-realtime-chart" class="w-full h-80"></div>
                    </div>
                </div>
            </div>

            <!-- Network Monitoring Section -->
            <div id="network-section" class="section mb-8">
                <h2 class="text-lg font-semibold mb-4 dark:text-white">Real-time Network Traffic (Bytes/sec)</h2>

                <!-- Real-time Network Traffic Chart -->
                <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg my-6 transition-colors duration-200">
                    <div class="px-4 py-5 sm:p-6">
                        <div id="network-realtime-chart" class="w-full" style="height: 400px;"></div>
                    </div>
                </div>

                <!-- Network Interfaces Table -->
                <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg transition-colors duration-200">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4">Network Interfaces</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Interface</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Bytes Sent</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Bytes Received</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Packets Sent</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Packets Received</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="network-interfaces-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                    <!-- Network interfaces will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4 text-sm text-gray-500 dark:text-gray-300">
                            <p>Active Connections: <span id="active-connections" class="font-semibold">0</span></p>
                        </div>
                    </div>
                </div>
                
            </div>

            <!-- Nginx Section -->
            <div id="nginx-section" class="section mb-8 hidden">
                <h2 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Nginx Virtual Host Manager</h2>
                <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg transition-colors duration-200">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="mb-4 flex space-x-3">
                            <button onclick="createVirtualHost()" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                Add Virtual Host
                            </button>
                            <button onclick="editNginxConfig()" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                Nginx Config
                            </button>
                            <button onclick="installCertbot()" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                </svg>
                                Install Certbot
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Domain</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Root Directory</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="vhost-list">
                                    <!-- Virtual hosts will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PHP Section -->
            <div id="php-section" class="section mb-8 hidden">
                <h2 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">PHP Management</h2>
                <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg transition-colors duration-200">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="mb-4">
                            <h3 class="text-lg font-medium mb-2 dark:text-white">PHP Configuration</h3>
                            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Memory Limit</label>
                                    <input type="text" id="memory_limit" class="mt-1 block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="128M">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Max Execution Time</label>
                                    <input type="text" id="max_execution_time" class="mt-1 block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="30">
                                </div>
                            </div>
                            <div class="mt-4">
                                <button onclick="savePhpConfig()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    Save Configuration
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MySQL Section -->
            <div id="mysql-section" class="section mb-8 hidden">
                <h2 class="text-lg font-semibold mb-4 dark:text-white">MySQL Management</h2>
                <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg mb-8 transition-colors duration-200">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="mb-4 flex space-x-3">
                            <button onclick="createDatabase()" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                Create Database
                            </button>
                            <button onclick="setRootPassword()" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500">
                                Set Root Password
                            </button>
                            <button onclick="editMariaDBConfig()" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                MariaDB Config
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Database Name</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Size</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="database-list">
                                    <!-- Databases will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div id="query-section" class="section mb-8 hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold dark:text-white">Database Query Interface</h2>
                    </div>
                    <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg transition-colors duration-200">
                        <div class="px-4 py-5 sm:p-6">
                            <div class="mb-4">
                                <label for="query-database" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Select Database</label>
                                <select id="query-database" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                    <option value="">Choose a database...</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label for="query-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300">SQL Query</label>
                                <textarea id="query-input" rows="4" class="mt-1 block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Enter your SQL query here..."></textarea>
                            </div>
                            <div class="flex justify-end">
                                <button onclick="executeQuery()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Execute Query</button>
                            </div>
                            <div id="query-result" class="mt-4 hidden">
                                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Query Result</h3>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700" id="query-result-header"></thead>
                                        <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="query-result-body"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="tables-section" class="hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold dark:text-white">Tables in <span id="current-database"></span></h2>
                    </div>
                    <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg transition-colors duration-200">
                        <div class="px-4 py-5 sm:p-6">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Table Name</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Rows</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Size (MB)</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="table-list">
                                        <!-- Tables will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Services Status -->
            <div id="services-section" class="section mb-8">
                <h2 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Services Status</h2>
                <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg transition-colors duration-200">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="grid grid-cols-1 gap-4 sm:grid-cols-3">
                            <div class="relative rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-6 py-5 shadow-sm flex items-center space-x-3 hover:border-gray-400 dark:hover:border-gray-500 transition-colors duration-200">
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">Nginx</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-300" id="nginx-status">Checking...</p>
                                    <div class="mt-3 flex space-x-2" id="nginx-buttons">
                                        <button onclick="startService('nginx')" class="px-3 py-1 text-sm font-medium text-white bg-green-600 rounded hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">Start</button>
                                        <button onclick="stopService('nginx')" class="px-3 py-1 text-sm font-medium text-white bg-red-600 rounded hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">Stop</button>
                                        <button onclick="installService('nginx')" class="px-3 py-1 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Install</button>
                                    </div>
                                </div>
                            </div>

                            <div class="relative rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-6 py-5 shadow-sm flex items-center space-x-3 hover:border-gray-400 dark:hover:border-gray-500 transition-colors duration-200">
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">PHP-FPM</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-300" id="php-status">Checking...</p>
                                    <div class="mt-3 flex space-x-2" id="php-buttons">
                                        <button onclick="startService('php-fpm')" class="px-3 py-1 text-sm font-medium text-white bg-green-600 rounded hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">Start</button>
                                        <button onclick="stopService('php-fpm')" class="px-3 py-1 text-sm font-medium text-white bg-red-600 rounded hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">Stop</button>
                                        <button onclick="installService('php-fpm')" class="px-3 py-1 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Install</button>
                                    </div>
                                </div>
                            </div>

                            <div class="relative rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-6 py-5 shadow-sm flex items-center space-x-3 hover:border-gray-400 dark:hover:border-gray-500 transition-colors duration-200">
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">MySQL</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-300" id="mysql-status">Checking...</p>
                                    <div class="mt-3 flex space-x-2" id="mysql-buttons">
                                        <button onclick="startService('mysql')" class="px-3 py-1 text-sm font-medium text-white bg-green-600 rounded hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">Start</button>
                                        <button onclick="stopService('mysql')" class="px-3 py-1 text-sm font-medium text-white bg-red-600 rounded hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">Stop</button>
                                        <button onclick="installService('mysql')" class="px-3 py-1 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Install</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Manager Section -->
            <div id="files-section" class="section mb-8 hidden">
                <h2 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">File Manager</h2>
                <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg transition-colors duration-200">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="mb-4 flex justify-between items-center">
                            <div class="flex space-x-2">
                                <button onclick="createDirectory()" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    New Directory
                                </button>
                                <button onclick="createNewFile()" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 mr-2">
                                    New File
                                </button>
                                <button onclick="document.getElementById('fileInput').click()" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                    Upload File
                                </button>
                                <input type="file" id="fileInput" class="hidden" onchange="uploadFile(this.files[0])">
                            </div>
                            <div class="text-sm text-gray-500 dark:text-gray-400 hidden sm:block" id="current-path">/</div>
                        </div>
                        <div class="mb-4">
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <svg class="h-5 w-5 text-gray-400 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                    </svg>
                                </div>
                                <input type="text" id="file-search" placeholder="Search files and directories..." class="block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md leading-5 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm transition-colors duration-200" oninput="searchFiles(this.value)">
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                    <button onclick="clearSearch()" class="text-gray-400 dark:text-gray-300 hover:text-gray-600 dark:hover:text-gray-100 focus:outline-none" id="clear-search-btn" style="display: none;">
                                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Name</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Size</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Modified</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="file-list">
                                    <!-- File list will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MySQL Information -->
            <div id="mysql-info-section" class="section">
                <h2 class="text-lg font-semibold mb-4 dark:text-white">MySQL Information</h2>
                <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg transition-colors duration-200">
                    <div class="px-4 py-5 sm:p-6">
                        <dl class="grid grid-cols-1 gap-x-4 gap-y-8 sm:grid-cols-2" id="mysql-info">
                            <div class="sm:col-span-1">
                                <dt class="text-sm font-medium text-gray-500 dark:text-gray-300">Version</dt>
                                <dd class="mt-1 text-sm text-gray-900 dark:text-white" id="mysql-version">Loading...</dd>
                            </div>
                            <div class="sm:col-span-1">
                                <dt class="text-sm font-medium text-gray-500 dark:text-gray-300">Connections</dt>
                                <dd class="mt-1 text-sm text-gray-900 dark:text-white" id="mysql-connections">Loading...</dd>
                            </div>
                        </dl>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Editor Modal -->
    <div id="editor-modal" class="fixed z-10 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle w-full max-w-sm sm:max-w-2xl md:max-w-5xl lg:max-w-7xl xl:max-w-screen-xl mx-4">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" id="editor-title">Edit File</h3>
                                <button onclick="toggleFullscreen()" class="inline-flex items-center px-2 py-1 border border-gray-300 dark:border-gray-600 text-xs font-medium rounded text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path>
                                    </svg>
                                    Fullscreen
                                </button>
                            </div>
                            
                            <!-- Editor Layout with Sidebar -->
                            <div class="flex border border-gray-300 dark:border-gray-600 rounded-md overflow-hidden" style="height: 500px;">
                                <!-- Sidebar File Browser -->
                                <div class="w-64 bg-gray-50 dark:bg-gray-700 border-r border-gray-300 dark:border-gray-600 flex flex-col">
                                    <!-- Sidebar Header -->
                                    <div class="p-3 border-b border-gray-300 dark:border-gray-600">
                                        <div class="flex items-center justify-between">
                                            <h4 class="text-sm font-medium text-gray-900 dark:text-white">Explorer</h4>
                                            <button onclick="refreshEditorSidebar()" class="p-1 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200" title="Refresh">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                                </svg>
                                            </button>
                                        </div>
                                        <div class="mt-2 text-xs text-gray-600 dark:text-gray-400" id="editor-current-path">Loading...</div>
                                    </div>
                                    
                                    <!-- File Tree -->
                                    <div class="flex-1 overflow-y-auto p-2">
                                        <div id="editor-file-tree" class="text-sm">
                                            <!-- File tree will be populated here -->
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Editor Area -->
                                <div class="flex-1 flex flex-col">
                                    <!-- Editor Toolbar -->
                                    <div class="bg-gray-100 dark:bg-gray-700 border-b border-gray-300 dark:border-gray-600 px-3 py-2 flex flex-wrap items-center gap-2 text-sm editor-toolbar">
                                        <button onclick="saveEditorFile()" class="inline-flex items-center px-2 py-1 text-xs font-medium rounded text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 editor-action-btn" title="Save (Ctrl+S)">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"></path>
                                            </svg>
                                            Save
                                        </button>
                                        <div class="w-px h-4 bg-gray-300 dark:bg-gray-600"></div>
                                        <button onclick="editorAction('undo')" class="inline-flex items-center px-2 py-1 text-xs font-medium rounded text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 editor-action-btn" title="Undo (Ctrl+Z)">
                                             <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path>
                                             </svg>
                                         </button>
                                         <button onclick="editorAction('redo')" class="inline-flex items-center px-2 py-1 text-xs font-medium rounded text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 editor-action-btn" title="Redo (Ctrl+Y)">
                                             <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 10H11a8 8 0 00-8 8v2m18-10l-6-6m6 6l-6 6"></path>
                                             </svg>
                                         </button>
                                        <div class="w-px h-4 bg-gray-300 dark:bg-gray-600"></div>
                                        <button onclick="editorAction('find')" class="inline-flex items-center px-2 py-1 text-xs font-medium rounded text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 editor-action-btn" title="Find (Ctrl+F)">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                            </svg>
                                            Find
                                        </button>
                                        <button onclick="editorAction('replace')" class="inline-flex items-center px-2 py-1 text-xs font-medium rounded text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 editor-action-btn" title="Replace (Ctrl+H)">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                                            </svg>
                                            Replace
                                        </button>
                                        <div class="w-px h-4 bg-gray-300 dark:bg-gray-600"></div>
                                        <button onclick="editorAction('format')" class="inline-flex items-center px-2 py-1 text-xs font-medium rounded text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 editor-action-btn" title="Format Document (Shift+Alt+F)">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h8m-8 6h16"></path>
                                            </svg>
                                            Format
                                        </button>
                                        <div class="w-px h-4 bg-gray-300 dark:bg-gray-600"></div>
                                        <select onchange="changeTheme(this.value)" class="text-xs border border-gray-300 dark:border-gray-600 rounded px-2 py-1 bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300">
                                            <option value="vs-dark">Dark Theme</option>
                                            <option value="vs">Light Theme</option>
                                            <option value="hc-black">High Contrast</option>
                                        </select>
                                        <select onchange="changeFontSize(this.value)" class="text-xs border border-gray-300 dark:border-gray-600 rounded px-2 py-1 bg-white dark:bg-gray-600 text-gray-700 dark:text-gray-300">
                                            <option value="12">12px</option>
                                            <option value="14" selected>14px</option>
                                            <option value="16">16px</option>
                                            <option value="18">18px</option>
                                            <option value="20">20px</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Tab Bar -->
                                    <div class="bg-gray-100 dark:bg-gray-800 border-b border-gray-300 dark:border-gray-600" id="tab-bar" style="display: none;">
                                        <div class="flex overflow-x-auto" id="editor-tabs">
                                            <!-- Tabs will be added here dynamically -->
                                        </div>
                                    </div>
                                    
                                    <!-- Monaco Editor -->
                                    <div class="flex-1">
                                        <div id="monaco-editor" style="height: 100%; width: 100%;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" onclick="saveFile()" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Save
                    </button>
                    <button type="button" onclick="closeEditor()" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="fixed z-10 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle w-full max-w-xs sm:max-w-lg mx-4">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Change Password</h3>
                    <div class="space-y-4">
                        <div>
                            <label for="current-password" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Current Password</label>
                            <input type="password" id="current-password" class="mt-1 block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="new-password" class="block text-sm font-medium text-gray-700 dark:text-gray-300">New Password</label>
                            <input type="password" id="new-password" class="mt-1 block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" onclick="changePassword()" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">Change Password</button>
                    <button type="button" onclick="hideChangePasswordModal()" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    function showTables(dbName) {
        document.getElementById('current-database').textContent = dbName;
        document.getElementById('tables-section').classList.remove('hidden');
        
        fetch(`/api/mysql/tables?database=${encodeURIComponent(dbName)}`)
            .then(response => response.json())
            .then(tables => {
                const tableList = document.getElementById('table-list');
                tableList.innerHTML = '';
                
                tables.forEach(table => {
                    tableList.innerHTML += `
                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200">
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${table.name}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${table.rows}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${table.size}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <button onclick="deleteTable('${table.name}')" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300">Delete</button>
                            </td>
                        </tr>
                    `;
                });
            })
            .catch(error => {
                console.error('Error:', error);
                showAlert('Failed to load tables', 'Error');
            });
    }

    function loadDatabases() {
        fetch('/api/mysql/databases')
            .then(response => response.json())
            .then(databases => {
                const databaseList = document.getElementById('database-list');
                const queryDatabaseSelect = document.getElementById('query-database');
                databaseList.innerHTML = '';
                queryDatabaseSelect.innerHTML = '<option value="">Choose a database...</option>';
                
                console.log('About to iterate databases:', databases, 'Type:', typeof databases, 'IsArray:', Array.isArray(databases));
                
                if (!databases || !Array.isArray(databases)) {
                    console.error('Databases is not a valid array:', databases);
                    return;
                }
                
                console.log('About to iterate databases:', databases, 'Type:', typeof databases, 'IsArray:', Array.isArray(databases));
                
                if (!databases || !Array.isArray(databases)) {
                    console.error('Databases is not a valid array at forEach:', databases);
                    return;
                }
                
                console.log('About to iterate databases:', databases, 'Type:', typeof databases, 'IsArray:', Array.isArray(databases));
                
                if (!databases || !Array.isArray(databases)) {
                    console.error('Databases is not a valid array at forEach:', databases);
                    return;
                }
                
                databases.forEach(db => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200';
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${db.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${db.size} MB</td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <button onclick="showTables('${db.name}')" class="text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 mr-4">Show Tables</button>
                            <button onclick="deleteDatabase('${db.name}')" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300">Delete</button>
                        </td>
                    `;
                    databaseList.appendChild(row);

                    // Add database to query interface select
                    const option = document.createElement('option');
                    option.value = db.name;
                    option.textContent = db.name;
                    queryDatabaseSelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error:', error);
                showAlert('Failed to load databases', 'Error');
            });
    }

    async function executeQuery() {
        const database = document.getElementById('query-database').value;
        const query = document.getElementById('query-input').value;

        if (!database) {
            showAlert('Please select a database', 'Peringatan');
            return;
        }

        if (!query) {
            showAlert('Please enter a query', 'Peringatan');
            return;
        }

        try {
            const response = await fetch('/api/mysql/execute-query', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    database: database,
                    query: query
                })
            });

            const result = await response.json();

            if (response.ok) {
                displayQueryResult(result);
                
                // Auto reload tables if query affects table structure
                const upperQuery = query.trim().toUpperCase();
                if (upperQuery.startsWith('CREATE TABLE') || 
                    upperQuery.startsWith('DROP TABLE') || 
                    upperQuery.startsWith('ALTER TABLE') ||
                    upperQuery.startsWith('TRUNCATE TABLE')) {
                    
                    // Check if tables section is visible and reload if needed
                    const tablesSection = document.getElementById('tables-section');
                    if (!tablesSection.classList.contains('hidden')) {
                        const currentDatabase = document.getElementById('current-database').textContent;
                        if (currentDatabase && currentDatabase === database) {
                            showTables(currentDatabase);
                        }
                    }
                }
            } else {
                showAlert(result.error || 'Error executing query', 'Error');
            }
        } catch (error) {
            console.error('Error:', error);
            showAlert('Error executing query', 'Error');
        }
    }

    function displayQueryResult(result) {
        const resultDiv = document.getElementById('query-result');
        const headerDiv = document.getElementById('query-result-header');
        const bodyDiv = document.getElementById('query-result-body');

        resultDiv.classList.remove('hidden');
        headerDiv.innerHTML = '';
        bodyDiv.innerHTML = '';

        if (result.length === 0) {
            bodyDiv.innerHTML = '<tr><td colspan="100%" class="px-6 py-4 text-sm text-gray-500 dark:text-gray-300 text-center">No results found</td></tr>';
            return;
        }

        // Create header
        const headerRow = document.createElement('tr');
        Object.keys(result[0]).forEach(key => {
            headerRow.innerHTML += `
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">${key}</th>
            `;
        });
        headerDiv.appendChild(headerRow);

        // Create body
        result.forEach(row => {
            const bodyRow = document.createElement('tr');
            bodyRow.className = 'hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200';
            Object.values(row).forEach(value => {
                bodyRow.innerHTML += `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${value}</td>
                `;
            });
            bodyDiv.appendChild(bodyRow);
        });
    }

    function showChangePasswordModal() {
        document.getElementById('changePasswordModal').classList.remove('hidden');
    }

    function hideChangePasswordModal() {
        document.getElementById('changePasswordModal').classList.add('hidden');
        document.getElementById('current-password').value = '';
        document.getElementById('new-password').value = '';
    }

    function changePassword() {
        const currentPassword = document.getElementById('current-password').value;
        const newPassword = document.getElementById('new-password').value;

        if (!currentPassword || !newPassword) {
            showAlert('Please fill in all fields', 'Peringatan');
            return;
        }

        fetch('/change-password', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                current_password: currentPassword,
                new_password: newPassword
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                showAlert(data.error, 'Error');
            } else {
                showAlert('Password changed successfully', 'Sukses');
                hideChangePasswordModal();
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showAlert('An error occurred while changing the password', 'Error');
        });
    }
    </script>

    <script>
        // Chart.js charts removed - now using ECharts for system resources
        
        // Initialize ECharts for network monitoring
        let realtimeChart;
        let systemRealtimeChart;
        let socket;
        let networkData = {
            timestamps: [],
            inbound: [],
            outbound: []
        };
        let systemData = {
            timestamps: [],
            cpu: [],
            memory: [],
            disk: []
        };
        
        const initializeNetworkCharts = () => {
            
            // Large real-time chart
            realtimeChart = echarts.init(document.getElementById('network-realtime-chart'));
            const realtimeOption = {
                title: {
                    textStyle: { color: document.documentElement.classList.contains('dark') ? '#fff' : '#000' }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'cross' }
                },
                legend: {
                    data: ['Inbound', 'Outbound'],
                    textStyle: { color: document.documentElement.classList.contains('dark') ? '#fff' : '#000' }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: [],
                    axisLabel: { color: document.documentElement.classList.contains('dark') ? '#fff' : '#000' }
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        color: document.documentElement.classList.contains('dark') ? '#fff' : '#000',
                        formatter: function(value) {
                            if (value >= 1024 * 1024 * 1024) {
                                return (value / (1024 * 1024 * 1024)).toFixed(1) + 'GB';
                            } else if (value >= 1024 * 1024) {
                                return (value / (1024 * 1024)).toFixed(1) + 'MB';
                            } else if (value >= 1024) {
                                return (value / 1024).toFixed(1) + 'KB';
                            }
                            return value + 'B';
                        }
                    }
                },
                series: [
                    {
                        name: 'Inbound',
                        type: 'line',
                        data: [],
                        smooth: true,
                        lineStyle: { color: '#3b82f6' },
                        areaStyle: { color: 'rgba(59, 130, 246, 0.1)' }
                    },
                    {
                        name: 'Outbound',
                        type: 'line',
                        data: [],
                        smooth: true,
                        lineStyle: { color: '#10b981' },
                        areaStyle: { color: 'rgba(16, 185, 129, 0.1)' }
                    }
                ]
            };
            realtimeChart.setOption(realtimeOption);
        };
        
        const initializeSystemCharts = () => {
            // System resources real-time chart
            systemRealtimeChart = echarts.init(document.getElementById('system-realtime-chart'));
            const systemOption = {
                title: {
                    textStyle: { color: document.documentElement.classList.contains('dark') ? '#fff' : '#000' }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'cross' }
                },
                legend: {
                    data: ['CPU', 'Memory', 'Disk'],
                    textStyle: { color: document.documentElement.classList.contains('dark') ? '#fff' : '#000' }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: [],
                    axisLabel: { color: document.documentElement.classList.contains('dark') ? '#fff' : '#000' }
                },
                yAxis: {
                    type: 'value',
                    min: 0,
                    max: 100,
                    axisLabel: {
                        color: document.documentElement.classList.contains('dark') ? '#fff' : '#000',
                        formatter: '{value}%'
                    }
                },
                series: [
                    {
                        name: 'CPU',
                        type: 'line',
                        data: [],
                        smooth: true,
                        lineStyle: { color: '#ef4444' },
                        areaStyle: { color: 'rgba(239, 68, 68, 0.1)' }
                    },
                    {
                        name: 'Memory',
                        type: 'line',
                        data: [],
                        smooth: true,
                        lineStyle: { color: '#3b82f6' },
                        areaStyle: { color: 'rgba(59, 130, 246, 0.1)' }
                    },
                    {
                        name: 'Disk',
                        type: 'line',
                        data: [],
                        smooth: true,
                        lineStyle: { color: '#10b981' },
                        areaStyle: { color: 'rgba(16, 185, 129, 0.1)' }
                    }
                ]
            };
            systemRealtimeChart.setOption(systemOption);
        };
        
        // Initialize SocketIO connection
        const initializeSocket = () => {
            socket = io(window.location.origin, {
                withCredentials: true,
                transports: ['polling', 'websocket']
            });
            
            socket.on('connect', () => {
                console.log('Connected to server');
            });
            
            socket.on('connect_error', (error) => {
                console.error('SocketIO connection error:', error);
                showNotification('Koneksi WebSocket gagal. Progress bar mungkin tidak berfungsi.', 'error');
            });
            
            socket.on('network_data', (data) => {
                updateNetworkCharts(data);
            });
            
            socket.on('error', (error) => {
                console.error('SocketIO error:', error);
                showNotification('Terjadi kesalahan WebSocket.', 'error');
            });
            
            socket.on('install_error', (data) => {
                console.log('Received install_error:', data);
                addInstallOutput(`❌ Error: ${data.message}`, 'error');
                
                // Re-enable close buttons
                const closeBtn = document.getElementById('install-close-btn');
                const cancelBtn = document.getElementById('install-cancel-btn');
                if (closeBtn) closeBtn.style.display = 'block';
                if (cancelBtn) {
                    cancelBtn.textContent = 'Close';
                    cancelBtn.disabled = false;
                    cancelBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            });
            
            // Installation progress events
            socket.on('install_progress', (data) => {
                console.log('Received install_progress:', data);
                updateInstallProgress(data.step, data.total, data.status, data.percentage);
            });
            
            socket.on('install_output', (data) => {
                console.log('Received install_output:', data);
                addInstallOutput(data.output, data.type || 'info');
            });
            
            socket.on('install_complete', (data) => {
                console.log('Received install_complete:', data);
                addInstallOutput(`✅ ${data.service} berhasil diinstall!`, 'success');
                updateInstallProgress(4, 4, 'Instalasi selesai', 100);
                
                // Re-enable close buttons
                const closeBtn = document.getElementById('install-close-btn');
                const cancelBtn = document.getElementById('install-cancel-btn');
                closeBtn.style.display = 'block';
                cancelBtn.textContent = 'Close';
                cancelBtn.disabled = false;
                cancelBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                
                // Update service status
                setTimeout(() => {
                    updateServiceStatus();
                }, 1000);
                
                showNotification(`${data.service} berhasil diinstall!`, 'success');
            });
            
            socket.on('install_error', (data) => {
                addInstallOutput(`❌ Error: ${data.message}`, 'error');
                
                // Re-enable close buttons
                const closeBtn = document.getElementById('install-close-btn');
                const cancelBtn = document.getElementById('install-cancel-btn');
                closeBtn.style.display = 'block';
                cancelBtn.textContent = 'Close';
                cancelBtn.disabled = false;
                cancelBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                
                showNotification(`Instalasi gagal: ${data.message}`, 'error');
            });
            
            // Request network data every 2 seconds
            setInterval(() => {
                if (socket.connected) {
                    socket.emit('request_network_data');
                }
            }, 2000);
        };
        
        let previousNetworkData = null;
        
        const updateNetworkCharts = (data) => {
            console.log('Received network data:', data);
            if (!data || !data.total_traffic) {
                console.log('No network data or total_traffic missing');
                return;
            }
            
            const currentTime = new Date().toLocaleTimeString();
            const currentInbound = data.total_traffic.bytes_recv;
            const currentOutbound = data.total_traffic.bytes_sent;
            
            // Calculate rates if we have previous data
            let inboundRate = 0;
            let outboundRate = 0;
            
            if (previousNetworkData) {
                const timeDiff = 2; // 2 seconds interval
                inboundRate = Math.max(0, (currentInbound - previousNetworkData.bytes_recv) / timeDiff);
                outboundRate = Math.max(0, (currentOutbound - previousNetworkData.bytes_sent) / timeDiff);
            }
            
            previousNetworkData = {
                bytes_recv: currentInbound,
                bytes_sent: currentOutbound
            };
            
            // Update network data arrays
            networkData.timestamps.push(currentTime);
            networkData.inbound.push(inboundRate);
            networkData.outbound.push(outboundRate);
            
            // Keep only last 30 data points
            if (networkData.timestamps.length > 30) {
                networkData.timestamps.shift();
                networkData.inbound.shift();
                networkData.outbound.shift();
            }
            
            // Update real-time chart only if it's initialized
            if (realtimeChart && typeof realtimeChart.setOption === 'function') {
                realtimeChart.setOption({
                    xAxis: { data: networkData.timestamps },
                    series: [
                        { data: networkData.inbound },
                        { data: networkData.outbound }
                    ]
                });
            }
        };

        // Update system information
        const updateSystemInfo = async () => {
            try {
                const response = await fetch('/api/system-info');
                const data = await response.json();
                
                console.log('Raw system data from API:', data);

                // Update server uptime
                if (data.uptime) {
                    document.getElementById('server-uptime').textContent = data.uptime;
                }
                
                // Update real-time system chart
                updateSystemCharts({
                    cpu_usage: data.cpu,
                    memory_usage: data.memory.percent,
                    disk_usage: data.disk.percent
                });
            } catch (error) {
                console.error('Error fetching system info:', error);
            }
        };

        // Update MySQL information
        const updateMySQLInfo = async () => {
            try {
                const response = await fetch('/api/mysql-info');
                const data = await response.json();

                if (data.error) {
                    document.getElementById('mysql-version').textContent = 'Error connecting to MySQL';
                    document.getElementById('mysql-connections').textContent = 'N/A';
                    return;
                }

                document.getElementById('mysql-version').textContent = data.version['version'] || 'N/A';
                document.getElementById('mysql-connections').textContent = data.status['Connections'] || 'N/A';
            } catch (error) {
                console.error('Error fetching MySQL info:', error);
            }
        };

        // Update network information (now handled by SocketIO)
        const updateNetworkInfo = async () => {
            try {
                const response = await fetch('/api/network-info');
                const data = await response.json();

                if (data.error) {
                    console.error('Error fetching network info:', data.error);
                    return;
                }

                // Update active connections and interfaces (non-real-time data)
                const activeConnections = document.getElementById('active-connections');
                if (activeConnections && data.connections !== undefined) {
                    activeConnections.textContent = data.connections;
                }

                // Update network interfaces table
                const tableBody = document.getElementById('network-interfaces-table');
                if (tableBody) {
                    tableBody.innerHTML = '';
                }

                if (data.interfaces && Array.isArray(data.interfaces)) {
                    data.interfaces.forEach(interface => {
                    // Only show interfaces that are up and have meaningful data
                    if (interface.is_up && interface.addresses.length > 0) {
                        const row = document.createElement('tr');
                        row.className = 'hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200';
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${interface.name}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300 text-right">-</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">-</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">-</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">-</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                                    interface.is_up ? 'bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100' : 'bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100'
                                }">
                                    ${interface.is_up ? 'Up' : 'Down'}
                                </span>
                            </td>
                        `;
                        if (tableBody) {
                            tableBody.appendChild(row);
                        }
                    }
                    });
                }

                // Charts are now updated via SocketIO in updateNetworkCharts function
                // No need to update charts here as they use ECharts, not Chart.js

            } catch (error) {
                console.error('Error fetching network info:', error);
            }
        };
        
        const updateSystemCharts = (data) => {
            if (!data || !systemRealtimeChart) {
                return;
            }
            
            console.log('System chart data received:', data);
            
            const currentTime = new Date().toLocaleTimeString();
            const cpuUsage = parseFloat(data.cpu_usage) || 0;
            const memoryUsage = parseFloat(data.memory_usage) || 0;
            const diskUsage = parseFloat(data.disk_usage) || 0;
            
            console.log('Parsed values - CPU:', cpuUsage, 'Memory:', memoryUsage, 'Disk:', diskUsage);
            
            // Update system data arrays
            systemData.timestamps.push(currentTime);
            systemData.cpu.push(cpuUsage);
            systemData.memory.push(memoryUsage);
            systemData.disk.push(diskUsage);
            
            // Keep only last 30 data points
            if (systemData.timestamps.length > 30) {
                systemData.timestamps.shift();
                systemData.cpu.shift();
                systemData.memory.shift();
                systemData.disk.shift();
            }
            
            // Update real-time chart
            systemRealtimeChart.setOption({
                xAxis: { data: systemData.timestamps },
                series: [
                    { data: systemData.cpu },
                    { data: systemData.memory },
                    { data: systemData.disk }
                ]
            });
        };

        // Update information periodically
        setInterval(updateSystemInfo, 2000);
        setInterval(updateMySQLInfo, 10000);
        setInterval(updateNetworkInfo, 3000);

        // File Manager Functions
        let currentPath = '/';
        let allFiles = []; // Store all files for search functionality
        let isSearchActive = false;

        function formatFileSize(bytes) {
            if (bytes === null) return '-';
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            if (bytes === 0) return '0 Byte';
            const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
            return Math.round(bytes / Math.pow(1024, i), 2) + ' ' + sizes[i];
        }

        function formatDate(timestamp) {
            return new Date(timestamp * 1000).toLocaleString();
        }

        async function loadFiles(path = '/var/www/html') {
            try {
                const response = await fetch(`/api/files?path=${encodeURIComponent(path)}`);
                const files = await response.json();
                currentPath = path;
                allFiles = files; // Store files for search
                document.getElementById('current-path').textContent = path;

                // Clear search if active
                if (isSearchActive) {
                    clearSearch();
                }

                renderFileList(files);
            } catch (error) {
                console.error('Error loading files:', error);
                showAlert('Error loading files', 'Error');
            }
        }

        function renderFileList(files) {
            const fileList = document.getElementById('file-list');
            fileList.innerHTML = '';

            if (currentPath !== '/' && !isSearchActive) {
                // Add parent directory link
                const parentPath = currentPath.split('/').slice(0, -1).join('/') || '/';
                fileList.innerHTML += `
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600 dark:text-blue-400 cursor-pointer" onclick="loadFiles('${parentPath}')">..</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">-</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">-</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300 text-right">-</td>
                    </tr>`;
            }

            files.sort((a, b) => {
                if (a.is_dir && !b.is_dir) return -1;
                if (!a.is_dir && b.is_dir) return 1;
                return a.name.localeCompare(b.name);
            }).forEach(file => {
                const icon = file.is_dir ? '📁' : '📄';
                fileList.innerHTML += `
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200">
                        <td class="px-6 py-4 whitespace-nowrap text-sm ${file.is_dir ? 'text-blue-600 dark:text-blue-400 cursor-pointer' : 'text-gray-900 dark:text-white'}" ${file.is_dir ? `onclick="loadFiles('${file.path}')"` : ''}>
                            ${icon} ${file.name}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${formatFileSize(file.size)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${formatDate(file.modified)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300 text-right">
                            <div class="flex items-center justify-end space-x-2">
                                ${!file.is_dir ? `<button onclick="openEditor('${file.path}')" class="inline-flex items-center px-2 py-1 border border-transparent text-xs font-medium rounded text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                    Edit
                                </button>` : ''}
                                <button onclick="renameFile('${file.path}')" class="inline-flex items-center px-2 py-1 border border-transparent text-xs font-medium rounded text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                                    </svg>
                                    Rename
                                </button>
                                <button onclick="deleteFile('${file.path}')" class="inline-flex items-center px-2 py-1 border border-transparent text-xs font-medium rounded text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                    Delete
                                </button>
                            </div>
                        </td>
                    </tr>`;
            });
        }

        function searchFiles(query) {
            const searchInput = document.getElementById('file-search');
            const clearBtn = document.getElementById('clear-search-btn');
            
            if (query.trim() === '') {
                clearSearch();
                return;
            }
            
            isSearchActive = true;
            clearBtn.style.display = 'block';
            
            // Filter files based on search query
            const filteredFiles = allFiles.filter(file => 
                file.name.toLowerCase().includes(query.toLowerCase())
            );
            
            // Update current path display to show search mode
            document.getElementById('current-path').textContent = `Search results for "${query}" in ${currentPath}`;
            
            renderFileList(filteredFiles);
        }
        
        function clearSearch() {
            const searchInput = document.getElementById('file-search');
            const clearBtn = document.getElementById('clear-search-btn');
            
            searchInput.value = '';
            clearBtn.style.display = 'none';
            isSearchActive = false;
            
            // Restore original path display
            document.getElementById('current-path').textContent = currentPath;
            
            // Show all files again
            renderFileList(allFiles);
        }

        async function createDirectory() {
            const dirName = await showPrompt('Enter directory name:', '', 'Create Directory');
            if (!dirName) return;

            try {
                const response = await fetch('/api/files/create-directory', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        path: currentPath + '/' + dirName
                    })
                });

                if (response.ok) {
                    loadFiles(currentPath);
                } else {
                    const error = await response.json();
                    showAlert(error.error || 'Error creating directory', 'Error');
                }
            } catch (error) {
                console.error('Error creating directory:', error);
                showAlert('Error creating directory', 'Error');
            }
        }

        async function uploadFile(file) {
            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);
            formData.append('path', currentPath);

            try {
                const response = await fetch('/api/files/upload', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    loadFiles(currentPath);
                } else {
                    const error = await response.json();
                    showAlert(error.error || 'Error uploading file', 'Error');
                }
            } catch (error) {
                console.error('Error uploading file:', error);
                showAlert('Error uploading file', 'Error');
            }
        }

        async function deleteFile(path) {
            if (!(await showConfirm('Are you sure you want to delete this item?', 'Konfirmasi Hapus'))) return;

            try {
                const response = await fetch('/api/files/delete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ path })
                });

                if (response.ok) {
                    loadFiles(currentPath);
                } else {
                    const error = await response.json();
                    showAlert(error.error || 'Error deleting item', 'Error');
                }
            } catch (error) {
                console.error('Error deleting item:', error);
                showAlert('Error deleting item', 'Error');
            }
        }

        async function renameFile(oldPath) {
            const newName = await showPrompt('Enter new name:', oldPath.split('/').pop(), 'Rename Item');
            if (!newName) return;

            const newPath = oldPath.split('/').slice(0, -1).concat(newName).join('/');

            try {
                const response = await fetch('/api/files/rename', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        old_path: oldPath,
                        new_path: newPath
                    })
                });

                if (response.ok) {
                    loadFiles(currentPath);
                } else {
                    const error = await response.json();
                    showAlert(error.error || 'Error renaming item', 'Error');
                }
            } catch (error) {
                console.error('Error renaming item:', error);
                showAlert('Error renaming item', 'Error');
            }
        }

        // Monaco Editor Setup
        let editor = null;
        let currentEditingFile = null;
        let editorTabs = [];
        let activeTabIndex = -1;
        let isSettingContent = false;

        require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' }});
        require(['vs/editor/editor.main'], function() {
            editor = monaco.editor.create(document.getElementById('monaco-editor'), {
                value: '',
                language: 'plaintext',
                theme: 'vs-dark',
                automaticLayout: true,
                minimap: { enabled: true },
                scrollBeyondLastLine: false,
                fontSize: 14,
                lineNumbers: 'on',
                renderWhitespace: 'selection',
                tabSize: 4
            });
            
            // Add event listener for content changes
            editor.onDidChangeModelContent(() => {
                // Ignore changes when we're setting content programmatically
                if (isSettingContent) return;
                
                if (activeTabIndex >= 0 && editorTabs[activeTabIndex]) {
                    const currentContent = editor.getValue();
                    // Compare with the original content when file was first loaded
                    const tab = editorTabs[activeTabIndex];
                    if (!tab.originalContent) {
                        tab.originalContent = tab.content;
                    }
                    const isModified = currentContent !== tab.originalContent;
                    
                    if (tab.modified !== isModified) {
                        tab.modified = isModified;
                        renderTabs();
                    }
                }
            });
        });

        function getFileExtension(filename) {
            return filename.slice((filename.lastIndexOf(".") - 1 >>> 0) + 2).toLowerCase();
        }

        function getLanguageFromExtension(ext) {
            const languageMap = {
                'js': 'javascript',
                'py': 'python',
                'html': 'html',
                'css': 'css',
                'json': 'json',
                'md': 'markdown',
                'sql': 'sql',
                'php': 'php',
                'sh': 'shell',
                'bash': 'shell',
                'txt': 'plaintext'
            };
            return languageMap[ext] || 'plaintext';
        }

        async function openEditor(path) {
            try {
                // Open the editor modal first
                document.getElementById('editor-modal').classList.remove('hidden');
                
                // Initialize sidebar when opening editor
                initializeEditorSidebar();
                
                // Open the file in a new tab
                await openEditorFile(path);
            } catch (error) {
                console.error('Error opening editor:', error);
                showAlert('Error opening editor', 'Error');
            }
        }

        function closeEditor() {
            // Check for unsaved changes in any tab
            const unsavedTabs = editorTabs.filter(tab => tab.modified);
            if (unsavedTabs.length > 0) {
                const fileNames = unsavedTabs.map(tab => tab.name).join(', ');
                if (!confirm(`You have unsaved changes in: ${fileNames}. Close anyway?`)) {
                    return;
                }
            }
            
            document.getElementById('editor-modal').classList.add('hidden');
            currentEditingFile = null;
            editorTabs = [];
            activeTabIndex = -1;
            
            // Clear editor content
            if (editor) {
                editor.setValue('');
            }
        }

        // Editor toolbar functions
        function editorAction(action) {
            if (!editor) return;
            
            switch(action) {
                case 'undo':
                    editor.trigger('keyboard', 'undo', null);
                    break;
                case 'redo':
                    editor.trigger('keyboard', 'redo', null);
                    break;
                case 'find':
                    editor.trigger('keyboard', 'actions.find', null);
                    break;
                case 'replace':
                    editor.trigger('keyboard', 'editor.action.startFindReplaceAction', null);
                    break;
                case 'format':
                    editor.trigger('keyboard', 'editor.action.formatDocument', null);
                    break;
                case 'comment':
                    editor.trigger('keyboard', 'editor.action.commentLine', null);
                    break;
            }
        }

        function toggleFullscreen() {
            const modal = document.getElementById('editor-modal');
            const modalContent = modal.querySelector('.inline-block');
            const editorLayout = modalContent.querySelector('.flex.border.border-gray-300');
            
            if (modalContent.classList.contains('fullscreen-editor')) {
                // Exit fullscreen
                modalContent.classList.remove('fullscreen-editor');
                modalContent.classList.add('w-full', 'max-w-sm', 'sm:max-w-2xl', 'md:max-w-5xl', 'lg:max-w-7xl', 'xl:max-w-screen-xl', 'mx-4');
                editorLayout.style.height = '500px';
                document.getElementById('monaco-editor').style.height = '100%';
                document.getElementById('monaco-editor').className = '';
            } else {
                // Enter fullscreen
                modalContent.classList.add('fullscreen-editor');
                modalContent.classList.remove('w-full', 'max-w-sm', 'sm:max-w-2xl', 'md:max-w-5xl', 'lg:max-w-7xl', 'xl:max-w-screen-xl', 'mx-4');
                editorLayout.style.height = 'calc(100vh - 150px)';
                document.getElementById('monaco-editor').style.height = '100%';
                document.getElementById('monaco-editor').className = '';
            }
            
            // Force complete editor refresh after fullscreen toggle
            setTimeout(() => {
                if (editor) {
                    // Store current content and cursor position
                    const currentContent = editor.getValue();
                    const currentPosition = editor.getPosition();
                    const currentLanguage = editor.getModel().getLanguageId();
                    
                    // Dispose current editor
                    editor.dispose();
                    
                    // Recreate editor
                    require(['vs/editor/editor.main'], function () {
                        editor = monaco.editor.create(document.getElementById('monaco-editor'), {
                            value: currentContent,
                            language: currentLanguage,
                            theme: 'vs-dark',
                            automaticLayout: true,
                            minimap: { enabled: true },
                            scrollBeyondLastLine: false,
                            fontSize: 14,
                            lineNumbers: 'on',
                            renderWhitespace: 'selection',
                            tabSize: 4
                        });
                        
                        // Restore cursor position
                        if (currentPosition) {
                            editor.setPosition(currentPosition);
                        }
                        
                        // Re-add content change listener
                        editor.onDidChangeModelContent(() => {
                            if (isSettingContent) return;
                            
                            if (activeTabIndex >= 0 && editorTabs[activeTabIndex]) {
                                const currentContent = editor.getValue();
                                const tab = editorTabs[activeTabIndex];
                                if (!tab.originalContent) {
                                    tab.originalContent = tab.content;
                                }
                                const isModified = currentContent !== tab.originalContent;
                                
                                if (tab.modified !== isModified) {
                                    tab.modified = isModified;
                                    renderTabs();
                                }
                            }
                        });
                    });
                }
            }, 100);
        }

        function changeTheme(theme) {
            if (editor) {
                monaco.editor.setTheme(theme);
            }
        }

        function changeFontSize(size) {
            if (editor) {
                editor.updateOptions({ fontSize: parseInt(size) });
            }
        }

        async function saveFile() {
            if (!currentEditingFile) return;

            try {
                const content = editor.getValue();
                const response = await fetch('/api/files/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        path: currentEditingFile,
                        content: content
                    })
                });

                if (response.ok) {
                    // Mark tab as saved
                    if (editorTabs[activeTabIndex]) {
                        isSettingContent = true; // Prevent change detection during save
                        editorTabs[activeTabIndex].modified = false;
                        editorTabs[activeTabIndex].content = content;
                        editorTabs[activeTabIndex].originalContent = content;
                        renderTabs();
                        isSettingContent = false;
                    }
                    showAlert('File saved successfully', 'Success');
                } else {
                    const error = await response.json();
                    showAlert(error.error || 'Error saving file', 'Error');
                }
            } catch (error) {
                console.error('Error saving file:', error);
                showAlert('Error saving file', 'Error');
            }
        }

        // Editor Sidebar Functions
        async function saveEditorFile() {
            if (!currentEditingFile || activeTabIndex < 0) return;

            try {
                const content = editor.getValue();
                const response = await fetch('/api/files/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        path: currentEditingFile,
                        content: content
                    })
                });

                if (response.ok) {
                    // Mark tab as saved
                    if (editorTabs[activeTabIndex]) {
                        isSettingContent = true; // Prevent change detection during save
                        editorTabs[activeTabIndex].modified = false;
                        editorTabs[activeTabIndex].content = content;
                        editorTabs[activeTabIndex].originalContent = content;
                        renderTabs();
                        isSettingContent = false;
                    }
                    showAlert('File saved successfully', 'Success');
                } else {
                    const error = await response.json();
                    showAlert(error.error || 'Error saving file', 'Error');
                }
            } catch (error) {
                console.error('Error saving file:', error);
                showAlert('Error saving file', 'Error');
            }
        }

        async function refreshEditorSidebar() {
            await loadEditorFileTree();
        }

        async function loadEditorFileTree() {
            try {
                const pathParam = currentPath || '/';
                const response = await fetch(`/api/files?path=${encodeURIComponent(pathParam)}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const files = await response.json();
                    // Convert the response format to match our expected format
                    const formattedFiles = files.map(file => ({
                        name: file.name,
                        path: file.path,
                        type: file.is_dir ? 'directory' : 'file'
                    }));
                    renderEditorFileTree(formattedFiles, pathParam);
                    document.getElementById('editor-current-path').textContent = pathParam;
                } else {
                    console.error('Error loading file tree');
                }
            } catch (error) {
                console.error('Error loading file tree:', error);
            }
        }

        function renderEditorFileTree(files, currentPath) {
            const fileTree = document.getElementById('editor-file-tree');
            fileTree.innerHTML = '';

            // Add back button if not in root
            if (currentPath !== '/') {
                const backItem = document.createElement('div');
                backItem.className = 'flex items-center p-2 hover:bg-gray-200 dark:hover:bg-gray-600 cursor-pointer rounded';
                backItem.innerHTML = `
                    <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    <span class="text-gray-600 dark:text-gray-300">..</span>
                `;
                backItem.onclick = () => navigateEditorPath('..');
                fileTree.appendChild(backItem);
            }

            files.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'flex items-center p-2 hover:bg-gray-200 dark:hover:bg-gray-600 cursor-pointer rounded';
                
                const isDirectory = file.type === 'directory';
                const icon = isDirectory ? 
                    `<svg class="w-4 h-4 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-5l-2-2H5a2 2 0 00-2 2z"></path>
                    </svg>` :
                    `<svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>`;
                
                fileItem.innerHTML = `
                    ${icon}
                    <span class="text-gray-900 dark:text-white truncate">${file.name}</span>
                `;
                
                if (isDirectory) {
                    fileItem.onclick = () => navigateEditorPath(file.name);
                } else {
                    fileItem.onclick = () => openEditorFile(file.path);
                }
                
                fileTree.appendChild(fileItem);
            });
        }

        async function navigateEditorPath(path) {
            if (path === '..') {
                // Go back to parent directory
                const pathParts = currentPath.split('/').filter(p => p);
                pathParts.pop();
                currentPath = '/' + pathParts.join('/');
                if (currentPath === '/') currentPath = '/';
            } else {
                // Navigate to subdirectory
                currentPath = currentPath.endsWith('/') ? currentPath + path : currentPath + '/' + path;
            }
            await loadEditorFileTree();
        }

        async function openEditorFile(filePath) {
            console.log('DEBUG: Opening file:', filePath);
            
            // Check if file is already open in a tab
            const existingTabIndex = editorTabs.findIndex(tab => tab.path === filePath);
            if (existingTabIndex !== -1) {
                switchToTab(existingTabIndex);
                return;
            }

            try {
                console.log('DEBUG: Sending request to /api/files/read');
                const response = await fetch('/api/files/read', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ path: filePath })
                });

                console.log('DEBUG: Response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('DEBUG: Response data:', data);
                    console.log('DEBUG: Content length:', data.content ? data.content.length : 'no content');
                    
                    // Create new tab
                    const newTab = {
                        path: filePath,
                        name: filePath.split('/').pop(),
                        content: data.content || '',
                        originalContent: data.content || '',
                        language: getLanguageFromExtension(getFileExtension(filePath)),
                        modified: false
                    };
                    
                    console.log('DEBUG: Created tab:', newTab);
                    
                    editorTabs.push(newTab);
                    activeTabIndex = editorTabs.length - 1;
                    
                    renderTabs();
                    
                    // Ensure editor is initialized before switching to tab
                    if (!editor) {
                        console.log('DEBUG: Editor not initialized, waiting...');
                        // Wait for editor to be initialized
                        const waitForEditorInit = () => {
                            if (editor) {
                                console.log('DEBUG: Editor ready, switching to tab');
                                switchToTab(activeTabIndex);
                            } else {
                                setTimeout(waitForEditorInit, 100);
                            }
                        };
                        waitForEditorInit();
                    } else {
                        console.log('DEBUG: Editor ready, switching to tab immediately');
                        switchToTab(activeTabIndex);
                    }
                } else {
                    console.log('DEBUG: Response not ok:', response.status);
                    const error = await response.json();
                    console.log('DEBUG: Error response:', error);
                    showAlert(error.error || 'Error reading file', 'Error');
                }
            } catch (error) {
                console.error('Error opening file:', error);
                showAlert('Error opening file', 'Error');
            }
        }

        // Tab Management Functions
        function renderTabs() {
            const tabsContainer = document.getElementById('editor-tabs');
            const tabBar = document.getElementById('tab-bar');
            
            tabsContainer.innerHTML = '';
            
            // Show/hide tab bar based on number of tabs
            if (editorTabs.length === 0) {
                tabBar.style.display = 'none';
                return;
            } else {
                tabBar.style.display = 'block';
            }
            
            editorTabs.forEach((tab, index) => {
                const tabElement = document.createElement('div');
                tabElement.className = `flex items-center px-3 py-2 border-r border-gray-300 dark:border-gray-600 cursor-pointer ${
                    index === activeTabIndex ? 'bg-white dark:bg-gray-700 text-gray-900 dark:text-white' : 'bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700'
                }`;
                
                tabElement.innerHTML = `
                    <span class="text-sm truncate max-w-32" title="${tab.path}">${tab.name}</span>
                    ${tab.modified ? '<span class="ml-1 text-xs text-orange-500">●</span>' : ''}
                    <button onclick="closeTab(${index})" class="ml-2 p-1 hover:bg-gray-300 dark:hover:bg-gray-600 rounded">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                `;
                
                tabElement.onclick = (e) => {
                    if (e.target.tagName !== 'BUTTON' && !e.target.closest('button')) {
                        switchToTab(index);
                    }
                };
                
                tabsContainer.appendChild(tabElement);
            });
        }
        
        function switchToTab(index) {
            console.log('DEBUG: Switching to tab:', index);
            if (index < 0 || index >= editorTabs.length) return;
            
            // Save current tab content if there's an active tab and it's different from the new tab
            if (activeTabIndex >= 0 && activeTabIndex < editorTabs.length && editor && activeTabIndex !== index) {
                editorTabs[activeTabIndex].content = editor.getValue();
                console.log('DEBUG: Saved content from previous tab:', activeTabIndex);
            }
            
            activeTabIndex = index;
            const tab = editorTabs[activeTabIndex];
            
            console.log('DEBUG: Tab data:', tab);
            console.log('DEBUG: Tab content length:', tab.content ? tab.content.length : 'no content');
            
            currentEditingFile = tab.path;
            document.getElementById('editor-title').textContent = `Edit File: ${tab.path}`;
            
            // Wait for editor to be ready if it's not initialized yet
            if (editor && editor.getModel()) {
                console.log('DEBUG: Editor ready, setting content');
                isSettingContent = true;
                monaco.editor.setModelLanguage(editor.getModel(), tab.language);
                editor.setValue(tab.content);
                console.log('DEBUG: Editor content set, length:', editor.getValue().length);
                isSettingContent = false;
            } else {
                console.log('DEBUG: Editor not ready, waiting...');
                // If editor is not ready, wait for it to be initialized
                const waitForEditor = () => {
                    if (editor && editor.getModel()) {
                        console.log('DEBUG: Editor ready after wait, setting content');
                        isSettingContent = true;
                        monaco.editor.setModelLanguage(editor.getModel(), tab.language);
                        editor.setValue(tab.content);
                        console.log('DEBUG: Editor content set after wait, length:', editor.getValue().length);
                        isSettingContent = false;
                    } else {
                        setTimeout(waitForEditor, 100);
                    }
                };
                waitForEditor();
            }
            
            renderTabs();
        }
        
        function closeTab(index) {
            if (index < 0 || index >= editorTabs.length) return;
            
            const tab = editorTabs[index];
            
            // Check if tab has unsaved changes
            if (tab.modified) {
                if (!confirm(`File "${tab.name}" has unsaved changes. Close anyway?`)) {
                    return;
                }
            }
            
            editorTabs.splice(index, 1);
            
            // Adjust active tab index
            if (activeTabIndex >= index && activeTabIndex > 0) {
                activeTabIndex--;
            } else if (editorTabs.length === 0) {
                activeTabIndex = -1;
                currentEditingFile = null;
                document.getElementById('editor-title').textContent = 'Code Editor';
                if (editor) {
                    editor.setValue('');
                }
            }
            
            renderTabs();
            
            // Switch to the new active tab if there are tabs remaining
            if (editorTabs.length > 0 && activeTabIndex >= 0) {
                switchToTab(activeTabIndex);
            }
        }

        // Initialize editor sidebar when modal opens
        function initializeEditorSidebar() {
            loadEditorFileTree();
        }

        // Section Management
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });

            if (sectionName === 'dashboard') {
                document.getElementById('dashboard-section').classList.remove('hidden');
                document.getElementById('services-section').classList.remove('hidden');
                document.getElementById('mysql-info-section').classList.remove('hidden');
                // Initialize system resources chart
                setTimeout(() => {
                    initializeSystemCharts();
                }, 100);
            } else if (sectionName === 'network') {
                document.getElementById('network-section').classList.remove('hidden');
                // Initialize ECharts and SocketIO for network monitoring
                setTimeout(() => {
                    initializeNetworkCharts();
                    initializeSocket();
                }, 100);
                updateNetworkInfo(); // Load initial network data
            } else if (sectionName === 'nginx') {
                document.getElementById('nginx-section').classList.remove('hidden');
            } else if (sectionName === 'php') {
                document.getElementById('php-section').classList.remove('hidden');
            } else if (sectionName === 'mysql') {
                document.getElementById('mysql-section').classList.remove('hidden');
                document.getElementById('query-section').classList.remove('hidden');
                loadDatabases();
            } else if (sectionName === 'files') {
                document.getElementById('files-section').classList.remove('hidden');
            }
        }

        // Theme Management
        let currentTheme = 'system';
        let systemPrefersDark = false;

        function setTheme(theme) {
            currentTheme = theme;
            localStorage.setItem('theme', theme);
            applyTheme();
            updateThemeUI();
            toggleThemeDropdown();
        }

        function applyTheme() {
            const html = document.documentElement;
            
            if (currentTheme === 'system') {
                if (systemPrefersDark) {
                    html.classList.add('dark');
                } else {
                    html.classList.remove('dark');
                }
            } else if (currentTheme === 'dark') {
                html.classList.add('dark');
            } else {
                html.classList.remove('dark');
            }
            
            // Update chart colors when theme changes
            setTimeout(() => {
                if (realtimeChart) {
                    const isDark = html.classList.contains('dark');
                    const textColor = isDark ? '#fff' : '#000';
                    
                    realtimeChart.setOption({
                        title: {
                            textStyle: { color: textColor }
                        },
                        legend: {
                            textStyle: { color: textColor }
                        },
                        xAxis: {
                            axisLabel: { color: textColor }
                        },
                        yAxis: {
                            axisLabel: { color: textColor }
                        }
                    });
                }
                
                if (systemRealtimeChart) {
                    const isDark = html.classList.contains('dark');
                    const textColor = isDark ? '#fff' : '#000';
                    
                    systemRealtimeChart.setOption({
                        title: {
                            textStyle: { color: textColor }
                        },
                        legend: {
                            textStyle: { color: textColor }
                        },
                        xAxis: {
                            axisLabel: { color: textColor }
                        },
                        yAxis: {
                            axisLabel: { color: textColor }
                        }
                    });
                }
            }, 100);
        }

        function updateThemeUI() {
            const themeIcon = document.getElementById('theme-icon-path');
            const themeText = document.getElementById('theme-text');
            
            if (currentTheme === 'light') {
                themeIcon.setAttribute('d', 'M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z');
                themeText.textContent = 'Light';
            } else if (currentTheme === 'dark') {
                themeIcon.setAttribute('d', 'M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z');
                themeText.textContent = 'Dark';
            } else {
                themeIcon.setAttribute('d', 'M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z');
                themeText.textContent = 'System';
            }
        }

        function toggleThemeDropdown() {
            const dropdown = document.getElementById('theme-dropdown-menu');
            dropdown.classList.toggle('hidden');
        }

        function initializeTheme() {
            // Check system preference
            systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            // Get saved theme or default to system
            const savedTheme = localStorage.getItem('theme');
            currentTheme = savedTheme || 'system';
            
            // Apply theme and update UI
            applyTheme();
            updateThemeUI();
            
            // Listen for system theme changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                systemPrefersDark = e.matches;
                if (currentTheme === 'system') {
                    applyTheme();
                }
            });
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            const themeDropdown = document.getElementById('theme-dropdown');
            const actionsDropdown = document.getElementById('actions-dropdown');
            
            if (!themeDropdown.contains(event.target)) {
                document.getElementById('theme-dropdown-menu').classList.add('hidden');
            }
            
            if (!actionsDropdown.contains(event.target)) {
                document.getElementById('actions-dropdown-menu').classList.add('hidden');
            }
        });

        // Call initialize function when page loads
        document.addEventListener('DOMContentLoaded', initializeTheme);

        // Actions Dropdown Management
        function toggleActionsDropdown() {
            const dropdown = document.getElementById('actions-dropdown-menu');
            dropdown.classList.toggle('hidden');
        }

        // Mobile Menu Management
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            const menuIcon = document.getElementById('mobile-menu-icon');
            const closeIcon = document.getElementById('mobile-close-icon');
            
            mobileMenu.classList.toggle('hidden');
            menuIcon.classList.toggle('hidden');
            closeIcon.classList.toggle('hidden');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('actions-dropdown');
            const dropdownMenu = document.getElementById('actions-dropdown-menu');
            
            if (!dropdown.contains(event.target)) {
                dropdownMenu.classList.add('hidden');
            }
        });

        // Virtual Host Management
        async function createVirtualHost() {
            const domain = await showPrompt('Enter domain name:', '', 'Add Virtual Host');
            if (!domain) return;

            const rootDir = await showPrompt('Enter root directory:', '/var/www/html/' + domain, 'Root Directory');
            if (!rootDir) return;

            try {
                const response = await fetch('/api/nginx/create-vhost', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        domain: domain,
                        root_dir: rootDir
                    })
                });

                if (response.ok) {
                    loadVirtualHosts();
                } else {
                    const error = await response.json();
                    showAlert(error.error || 'Error creating virtual host', 'Error');
                }
            } catch (error) {
                console.error('Error creating virtual host:', error);
                showAlert('Error creating virtual host', 'Error');
            }
        }

        async function loadVirtualHosts() {
            try {
                const response = await fetch('/api/nginx/vhosts');
                
                // Check if response is successful
                if (!response.ok) {
                    console.error('Error loading virtual hosts: HTTP', response.status);
                    return;
                }
                
                let vhosts;
                try {
                    vhosts = await response.json();
                } catch (jsonError) {
                    console.error('Error parsing virtual hosts response as JSON:', jsonError);
                    return;
                }
                
                const vhostList = document.getElementById('vhost-list');
                vhostList.innerHTML = '';

                // Check if response contains error or is not an array
                if (vhosts.error || !Array.isArray(vhosts)) {
                    console.error('Error loading virtual hosts:', vhosts.error || 'Invalid response format');
                    vhostList.innerHTML = `
                        <tr>
                            <td colspan="4" class="px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400">
                                Unable to load virtual hosts: ${vhosts.error || 'Authentication required'}
                            </td>
                        </tr>
                    `;
                    return;
                }

                try {
                    vhosts.forEach(vhost => {
                        vhostList.innerHTML += `
                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                                    <a href="http://${vhost.domain}" target="_blank" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 underline">${vhost.domain}</a>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${vhost.root_dir}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${vhost.enabled ? 'Enabled' : 'Disabled'}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                                    <button onclick="openVHostSettings('${vhost.domain}', '${vhost.root_dir}', ${vhost.enabled})" class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-2">Settings</button>
                                    <button onclick="toggleVHost('${vhost.domain}', ${!vhost.enabled})" class="text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 mr-2">${vhost.enabled ? 'Disable' : 'Enable'}</button>
                                    <button onclick="deleteVHost('${vhost.domain}')" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300">Delete</button>
                                </td>
                            </tr>`;
                    });
                } catch (forEachError) {
                    console.error('Error iterating virtual hosts:', forEachError);
                    vhostList.innerHTML = `
                        <tr>
                            <td colspan="4" class="px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400">
                                Error displaying virtual hosts
                            </td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('Error loading virtual hosts:', error);
            }
        }

        async function deleteVHost(domain) {
            if (!(await showConfirm(`Are you sure you want to delete virtual host '${domain}'?`, 'Konfirmasi Hapus'))) return;

            try {
                const response = await fetch('/api/nginx/delete-vhost', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        domain: domain
                    })
                });

                if (response.ok) {
                    loadVirtualHosts();
                } else {
                    const error = await response.json();
                    showAlert(error.error || 'Error deleting virtual host', 'Error');
                }
            } catch (error) {
                console.error('Error deleting virtual host:', error);
                showAlert('Error deleting virtual host', 'Error');
            }
        }

        async function toggleVHost(domain, enable) {
            try {
                const response = await fetch('/api/nginx/toggle-vhost', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        domain: domain,
                        enable: enable
                    })
                });

                if (response.ok) {
                    loadVirtualHosts();
                } else {
                    const error = await response.json();
                    showAlert(error.error || 'Error toggling virtual host', 'Error');
                }
            } catch (error) {
                console.error('Error toggling virtual host:', error);
                showAlert('Error toggling virtual host', 'Error');
            }
        }

        // Virtual Host Settings Management
        function openVHostSettings(domain, rootDir, enabled) {
            document.getElementById('vhost-domain').value = domain;
            document.getElementById('vhost-root-dir').value = rootDir;
            document.getElementById('vhost-status').value = enabled.toString();
            
            // Set config filename
            document.getElementById('config-filename').textContent = domain;
            
            // Reset to first tab
            switchVHostTab('domain');
            
            document.getElementById('vhost-settings-modal').classList.remove('hidden');
        }

        function closeVHostSettingsModal() {
            document.getElementById('vhost-settings-modal').classList.add('hidden');
        }

        function switchVHostTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.vhost-tab-content');
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });

            // Reset all tab buttons
            const tabButtons = document.querySelectorAll('.vhost-tab-btn');
            tabButtons.forEach(button => {
                button.classList.remove('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
                button.classList.add('border-transparent', 'text-gray-500', 'dark:text-gray-400');
            });

            // Show selected tab content
            const selectedContent = document.getElementById(`content-${tabName}`);
            if (selectedContent) {
                selectedContent.classList.remove('hidden');
            }

            // Activate selected tab button
            const selectedButton = document.getElementById(`tab-${tabName}`);
            if (selectedButton) {
                selectedButton.classList.remove('border-transparent', 'text-gray-500', 'dark:text-gray-400');
                selectedButton.classList.add('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
            }

            // Auto-load config when Config tab is clicked
            if (tabName === 'config') {
                loadVHostConfig();
            }
            
            // Auto-check SSL certificates when SSL tab is clicked
            if (tabName === 'ssl') {
                checkExistingSSLCertificates();
            }
        }

        async function loadVHostConfig() {
            const domain = document.getElementById('vhost-domain').value;
            if (!domain) {
                showAlert('Please select a virtual host first.');
                return;
            }

            try {
                const response = await fetch(`/api/nginx/config/${domain}`);
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('vhost-custom-config').value = data.config || '';
                    showAlert('Configuration loaded successfully!', 'Success');
                } else {
                    const error = await response.json();
                    showAlert(`Failed to load configuration: ${error.message}`, 'Error');
                }
            } catch (error) {
                console.error('Error loading config:', error);
                showAlert('Failed to load configuration. Please try again.', 'Error');
            }
        }

        async function checkExistingSSLCertificates() {
            const domain = document.getElementById('vhost-domain').value;
            if (!domain) {
                return;
            }

            try {
                const response = await fetch(`/api/ssl/check/${domain}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.cert_exists && data.key_exists) {
                        // Auto-fill SSL certificate paths
                        document.getElementById('vhost-ssl-cert').value = data.cert_path;
                        document.getElementById('vhost-ssl-key').value = data.key_path;
                        
                        // Show notification
                        showNotification(`SSL certificate found for ${domain}`, 'success');
                    }
                }
            } catch (error) {
                console.error('Error checking SSL certificates:', error);
            }
        }

        async function saveVHostSettings() {
            const domain = document.getElementById('vhost-domain').value;
            const rootDir = document.getElementById('vhost-root-dir').value;
            const enabled = document.getElementById('vhost-status').value === 'true';
            const ssl = document.getElementById('vhost-ssl').checked;
            const sslCert = document.getElementById('vhost-ssl-cert').value;
            const sslKey = document.getElementById('vhost-ssl-key').value;
            const forceHttps = document.getElementById('vhost-force-https').checked;
            const phpVersion = document.getElementById('vhost-php-version').value;
            const customConfig = document.getElementById('vhost-custom-config').value;

            try {
                const response = await fetch('/api/nginx/update-vhost', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        domain: domain,
                        root_dir: rootDir,
                        enabled: enabled,
                        ssl: ssl,
                        ssl_cert: sslCert,
                        ssl_key: sslKey,
                        force_https: forceHttps,
                        php_version: phpVersion,
                        custom_config: customConfig
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        showAlert('Virtual host settings updated successfully!', 'Success');
                        closeVHostSettingsModal();
                        loadVirtualHosts(); // Refresh the list
                    } else {
                        showAlert(result.error || 'Error updating virtual host settings', 'Error');
                    }
                } else {
                    const error = await response.json();
                    showAlert(error.error || 'Error updating virtual host settings', 'Error');
                }
            } catch (error) {
                console.error('Error updating virtual host settings:', error);
                showAlert('Error updating virtual host settings', 'Error');
            }
        }

        async function generateLetsEncryptSSL() {
            const domain = document.getElementById('vhost-domain').value;
            const email = document.getElementById('vhost-letsencrypt-email').value;

            if (!domain) {
                showAlert('Domain is required', 'Error');
                return;
            }

            if (!email) {
                showAlert('Email address is required for Let\'s Encrypt', 'Error');
                return;
            }

            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showAlert('Please enter a valid email address', 'Error');
                return;
            }

            // Show installation modal
            showInstallModal('Let\'s Encrypt SSL');
            
            // Update progress
            updateInstallProgress('Memulai proses generate SSL certificate...', '1/4', 10);
            addInstallOutput('Starting Let\'s Encrypt SSL certificate generation...', 'info');
            addInstallOutput(`Domain: ${domain}`, 'info');
            addInstallOutput(`Email: ${email}`, 'info');

            try {
                // Connect to WebSocket for real-time output
                const socket = io();
                
                socket.on('ssl_generate_output', function(data) {
                    addInstallOutput(data.message, data.type || 'info');
                });
                
                socket.on('ssl_generate_progress', function(data) {
                    updateInstallProgress(data.status, data.step, data.progress);
                });
                
                socket.on('ssl_generate_complete', function(data) {
                    if (data.success) {
                        addInstallOutput('SSL certificate generated successfully!', 'success');
                        updateInstallProgress('SSL certificate generated', '4/4', 100);
                        
                        // Update SSL certificate paths if provided
                        if (data.cert_path) {
                            document.getElementById('vhost-ssl-cert').value = data.cert_path;
                        }
                        if (data.key_path) {
                            document.getElementById('vhost-ssl-key').value = data.key_path;
                        }
                        
                        // Enable SSL checkbox
                        document.getElementById('vhost-ssl').checked = true;
                        
                        showNotification('SSL certificate generated successfully!', 'success');
                    } else {
                        addInstallOutput(`SSL generation failed: ${data.error}`, 'error');
                        updateInstallProgress('SSL generation failed', '4/4', 100);
                        showNotification(data.error || 'Failed to generate SSL certificate', 'error');
                    }
                    
                    // Re-enable close button
                    const closeBtn = document.getElementById('install-close-btn');
                    const cancelBtn = document.getElementById('install-cancel-btn');
                    closeBtn.style.display = 'block';
                    cancelBtn.textContent = 'Close';
                    cancelBtn.disabled = false;
                    cancelBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    
                    socket.disconnect();
                });
                
                const response = await fetch('/api/ssl/letsencrypt', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        domain: domain,
                        email: email
                    })
                });

                if (!response.ok) {
                    const data = await response.json();
                    addInstallOutput(`SSL generation failed: ${data.error}`, 'error');
                    updateInstallProgress('SSL generation failed', '4/4', 100);
                    showNotification(data.error || 'Failed to generate SSL certificate', 'error');
                    
                    // Re-enable close button
                    const closeBtn = document.getElementById('install-close-btn');
                    const cancelBtn = document.getElementById('install-cancel-btn');
                    closeBtn.style.display = 'block';
                    cancelBtn.textContent = 'Close';
                    cancelBtn.disabled = false;
                    cancelBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
                
            } catch (error) {
                console.error('Error generating SSL certificate:', error);
                addInstallOutput(`SSL generation error: ${error.message}`, 'error');
                updateInstallProgress('SSL generation failed', '4/4', 100);
                showNotification('Failed to generate SSL certificate. Please try again.', 'error');
                
                // Re-enable close button
                const closeBtn = document.getElementById('install-close-btn');
                const cancelBtn = document.getElementById('install-cancel-btn');
                closeBtn.style.display = 'block';
                cancelBtn.textContent = 'Close';
                cancelBtn.disabled = false;
                cancelBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // PHP Configuration Management
        async function savePhpConfig() {
            const memoryLimit = document.getElementById('memory_limit').value;
            const maxExecutionTime = document.getElementById('max_execution_time').value;

            try {
                const response = await fetch('/api/php/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        memory_limit: memoryLimit,
                        max_execution_time: maxExecutionTime
                    })
                });

                if (response.ok) {
                    showAlert('PHP configuration saved successfully', 'Sukses');
                } else {
                    const error = await response.json();
                    showAlert(error.error || 'Error saving PHP configuration', 'Error');
                }
            } catch (error) {
                console.error('Error saving PHP configuration:', error);
                showAlert('Error saving PHP configuration', 'Error');
            }
        }

        // Notification system
        function showNotification(message, type = 'info') {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notif => notif.remove());

            const notification = document.createElement('div');
            notification.className = `notification fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm transition-all duration-300 transform translate-x-full`;
            
            const colors = {
                'success': 'bg-green-500 text-white',
                'error': 'bg-red-500 text-white',
                'warning': 'bg-yellow-500 text-black',
                'info': 'bg-blue-500 text-white'
            };
            
            notification.className += ` ${colors[type] || colors.info}`;
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-lg font-bold">&times;</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }

        // MySQL Database Management
        async function createDatabase() {
            showCreateDatabaseModal();
        }
        
        function showCreateDatabaseModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50';
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-gray-800">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 dark:text-white text-center mb-4">Buat Database Baru</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nama Database *</label>
                                <input type="text" id="dbNameInput" 
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" 
                                       placeholder="nama_database">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Username Database (Opsional)</label>
                                <input type="text" id="dbUserInput" 
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" 
                                       placeholder="username">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Password Database (Opsional)</label>
                                <input type="password" id="dbPasswordInput" 
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" 
                                       placeholder="password">
                            </div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">
                                <p>• Nama database hanya boleh menggunakan huruf, angka, dan underscore</p>
                                <p>• Jika username dan password diisi, akan dibuat user khusus untuk database ini</p>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-2 mt-6">
                            <button id="createDbCancelBtn" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-400 dark:hover:bg-gray-500">Batal</button>
                            <button id="createDbOkBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Buat Database</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const dbNameInput = document.getElementById('dbNameInput');
            const dbUserInput = document.getElementById('dbUserInput');
            const dbPasswordInput = document.getElementById('dbPasswordInput');
            
            dbNameInput.focus();
            
            const handleCreate = async () => {
                const dbName = dbNameInput.value.trim();
                const dbUser = dbUserInput.value.trim();
                const dbPassword = dbPasswordInput.value;
                
                if (!dbName) {
                    showNotification('Nama database harus diisi', 'warning');
                    return;
                }
                
                if (dbUser && !dbPassword) {
                    showNotification('Password harus diisi jika username diisi', 'warning');
                    return;
                }
                
                if (!dbUser && dbPassword) {
                    showNotification('Username harus diisi jika password diisi', 'warning');
                    return;
                }
                
                document.body.removeChild(modal);
                
                // Show loading notification
                showNotification('Membuat database...', 'info');
                
                try {
                    const requestBody = { name: dbName };
                    if (dbUser && dbPassword) {
                        requestBody.user = dbUser;
                        requestBody.password = dbPassword;
                    }
                    
                    const response = await fetch('/api/mysql/create-db', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestBody)
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        showNotification(result.message || 'Database berhasil dibuat', 'success');
                        loadDatabases();
                    } else {
                        showNotification(result.error || 'Error membuat database', 'error');
                    }
                } catch (error) {
                    console.error('Error creating database:', error);
                    showNotification('Terjadi kesalahan saat membuat database', 'error');
                }
            };
            
            const handleCancel = () => {
                document.body.removeChild(modal);
            };
            
            document.getElementById('createDbOkBtn').addEventListener('click', handleCreate);
            document.getElementById('createDbCancelBtn').addEventListener('click', handleCancel);
            
            // Handle Enter key
            [dbNameInput, dbUserInput, dbPasswordInput].forEach(input => {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        handleCreate();
                    }
                });
            });
            
            modal.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    handleCancel();
                }
            });
        }

        async function loadDatabases() {
            try {
                const response = await fetch('/api/mysql/databases');
                
                // Check if response is successful
                if (!response.ok) {
                    console.error('Error loading databases: HTTP', response.status);
                    return;
                }
                
                let data;
                try {
                    data = await response.json();
                } catch (jsonError) {
                    console.error('Error parsing databases response as JSON:', jsonError);
                    return;
                }
                const dbList = document.getElementById('database-list');
                const queryDatabase = document.getElementById('query-database');
                dbList.innerHTML = '';
                queryDatabase.innerHTML = '<option value="">Choose a database...</option>';

                // Check if response contains error
                if (data.error) {
                    console.error('Error loading databases:', data.error);
                    // Show error message in the table
                    dbList.innerHTML = `
                        <tr>
                            <td colspan="3" class="px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400">
                                MySQL connection not available: ${data.error}
                            </td>
                        </tr>
                    `;
                    return;
                }

                // Check if MySQL service is unavailable
                if (data.service_status === 'unavailable') {
                    showNotification(data.message, 'warning');
                    // Show empty state message in the table
                    dbList.innerHTML = `
                        <tr>
                            <td colspan="3" class="px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400">
                                ${data.message}
                            </td>
                        </tr>
                    `;
                    return;
                }

                // Handle normal database list (when service is available)
                const databases = data.databases || data; // Support both new and old response format
                
                // Check if databases is an array
                if (!Array.isArray(databases)) {
                    console.error('Error loading databases: databases is not an array', databases);
                    // Show error message in the table
                    dbList.innerHTML = `
                        <tr>
                            <td colspan="3" class="px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400">
                                Unable to load databases: Invalid data format
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                try {
                    databases.forEach(db => {
                        dbList.innerHTML += `
                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${db.name}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${formatFileSize(db.size)}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                                    <button onclick="showTables('${db.name}')" class="text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 mr-4">Show Tables</button>
                                    <button onclick="deleteDatabase('${db.name}')" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300">Delete</button>
                            </td>
                        </tr>`;
                        queryDatabase.innerHTML += `<option value="${db.name}">${db.name}</option>`;
                    });
                } catch (forEachError) {
                    console.error('Error iterating databases:', forEachError);
                    dbList.innerHTML = `
                        <tr>
                            <td colspan="3" class="px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400">
                                Error displaying databases
                            </td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('Error loading databases:', error);
            }
        }

        async function createNewFile() {
            const fileName = await showPrompt('Enter file name:', '', 'Create File');
            if (!fileName) return;

            try {
                const response = await fetch('/api/files/new', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        path: currentPath,
                        name: fileName
                    })
                });

                if (response.ok) {
                    loadFiles(currentPath);
                } else {
                    const error = await response.json();
                    showAlert(error.error || 'Error creating file', 'Error');
                }
            } catch (error) {
                console.error('Error creating file:', error);
                showAlert('Error creating file', 'Error');
            }
        }

        async function deleteDatabase(dbName) {
            if (!(await showConfirm(`Apakah Anda yakin ingin menghapus database '${dbName}'?`, 'Konfirmasi Hapus Database'))) return;

            // Show loading notification
            showNotification('Menghapus database...', 'info');

            try {
                const response = await fetch('/api/mysql/delete-db', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: dbName
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    showNotification(result.message || 'Database berhasil dihapus', 'success');
                    loadDatabases();
                } else {
                    showNotification(result.error || 'Error menghapus database', 'error');
                }
            } catch (error) {
                console.error('Error deleting database:', error);
                showNotification('Terjadi kesalahan saat menghapus database', 'error');
            }
        }

        async function setRootPassword() {
            try {
                // Get current password first
                const currentResponse = await fetch('/api/mysql/get-root-password');
                const currentData = await currentResponse.json();
                
                let currentPassword = '';
                if (currentResponse.ok) {
                    currentPassword = currentData.password || '';
                }
                
                // Create modal dialog with form input
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50';
                modal.innerHTML = `
                    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-gray-800">
                        <div class="mt-3 text-center">
                            <h3 class="text-lg font-medium text-gray-900 dark:text-white">Set Root Password MySQL</h3>
                            <div class="mt-4">
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">Password saat ini: <span class="font-mono">${currentPassword || '(kosong)'}</span></p>
                                <input type="text" id="newPasswordInput" 
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                       placeholder="Masukkan password baru (kosongkan untuk password kosong)" 
                                       value="${currentPassword}">
                            </div>
                            <div class="flex justify-center space-x-3 mt-6">
                                <button id="cancelBtn" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-400 dark:hover:bg-gray-500">Batal</button>
                                <button id="confirmBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Simpan</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Focus on input
                const input = document.getElementById('newPasswordInput');
                input.focus();
                input.select();
                
                // Handle modal events
                 const handleSubmit = async () => {
                     const newPassword = input.value;
                     document.body.removeChild(modal);
                     
                     try {
                         // Show loading notification
                         showNotification('Mengatur password root...', 'info');

                         const response = await fetch('/api/mysql/set-root-password', {
                             method: 'POST',
                             headers: {
                                 'Content-Type': 'application/json'
                             },
                             body: JSON.stringify({
                                 password: newPassword
                             })
                         });

                         const result = await response.json();

                         if (response.ok) {
                             showNotification(result.message || 'Password root berhasil diatur', 'success');
                         } else {
                             showNotification(result.error || 'Error mengatur password root', 'error');
                         }
                     } catch (error) {
                         console.error('Error setting root password:', error);
                         showNotification('Terjadi kesalahan saat mengatur password root', 'error');
                     }
                 };
                 
                 const handleCancel = () => {
                     document.body.removeChild(modal);
                 };
                 
                 // Add event listeners
                 document.getElementById('confirmBtn').addEventListener('click', handleSubmit);
                 document.getElementById('cancelBtn').addEventListener('click', handleCancel);
                 
                 // Handle Enter key
                 input.addEventListener('keypress', (e) => {
                     if (e.key === 'Enter') {
                         handleSubmit();
                     }
                 });
                 
                 // Handle Escape key
                 modal.addEventListener('keydown', (e) => {
                     if (e.key === 'Escape') {
                         handleCancel();
                     }
                 });
                 
             } catch (error) {
                 console.error('Error getting current password:', error);
                 showNotification('Terjadi kesalahan saat mengambil password saat ini', 'error');
             }
        }

        async function deleteTable(tableName) {
            const currentDatabase = document.getElementById('current-database').textContent;
            if (!(await showConfirm(`Apakah Anda yakin ingin menghapus tabel '${tableName}' dari database '${currentDatabase}'?`, 'Konfirmasi Hapus Tabel'))) return;

            // Show loading notification
            showNotification('Menghapus tabel...', 'info');

            try {
                const response = await fetch('/api/mysql/delete-table', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        database: currentDatabase,
                        table: tableName
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    showNotification(result.message || 'Tabel berhasil dihapus', 'success');
                    showTables(currentDatabase); // Refresh table list
                } else {
                    showNotification(result.error || 'Error menghapus tabel', 'error');
                }
            } catch (error) {
                console.error('Error deleting table:', error);
                showNotification('Terjadi kesalahan saat menghapus tabel', 'error');
            }
        }

        // Initial updates
        showSection('dashboard');
        updateSystemInfo();
        updateMySQLInfo();
        loadFiles();
        loadVirtualHosts();
        loadDatabases();
        
        // Initialize socket connection for installation features
        initializeSocket();
        
        // Backup and restore functions removed
</script>
    <script>
        // Fungsi untuk memulai layanan
        async function startService(service) {
            try {
                const response = await fetch(`/api/service/${service}/start`, {
                    method: 'POST'
                });
                const data = await response.json();
                if (data.success) {
                    updateServiceStatus();
                } else {
                    showAlert(`Gagal memulai ${service}: ${data.message}`, 'Error');
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert(`Terjadi kesalahan saat memulai ${service}`, 'Error');
            }
        }

        // Fungsi untuk menghentikan layanan
        async function stopService(service) {
            try {
                const response = await fetch(`/api/service/${service}/stop`, {
                    method: 'POST'
                });
                const data = await response.json();
                if (data.success) {
                    updateServiceStatus();
                } else {
                    showAlert(`Gagal menghentikan ${service}: ${data.message}`, 'Error');
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert(`Terjadi kesalahan saat menghentikan ${service}`, 'Error');
            }
        }

        // Fungsi untuk menginstall layanan dengan modal real-time
        async function installService(service) {
            if (!(await showConfirm(`Apakah Anda yakin ingin menginstall ${service}? Proses ini mungkin memakan waktu beberapa menit.`, 'Konfirmasi Install'))) {
                return;
            }

            try {
                // Show installation modal
                showInstallModal(service);
                
                // Emit install_service event via WebSocket
                if (socket && socket.connected) {
                    socket.emit('install_service', { service: service });
                } else {
                    showNotification('WebSocket connection not available', 'error');
                    closeInstallModal();
                }
            } catch (error) {
                console.error('Error starting installation:', error);
                showNotification('Installation failed to start', 'error');
                closeInstallModal();
            }
        }
        
        // Show installation modal
        function showInstallModal(service) {
            const modal = document.getElementById('install-modal');
            const title = document.getElementById('install-modal-title');
            const output = document.getElementById('install-output');
            const status = document.getElementById('install-status');
            const step = document.getElementById('install-step');
            const progressBar = document.getElementById('install-progress-bar');
            const closeBtn = document.getElementById('install-close-btn');
            const cancelBtn = document.getElementById('install-cancel-btn');
            
            // Set modal title
            title.textContent = `Installing ${service.charAt(0).toUpperCase() + service.slice(1)}`;
            
            // Reset modal state
            output.innerHTML = '';
            status.textContent = 'Memulai instalasi...';
            step.textContent = '0/4';
            progressBar.style.width = '0%';
            
            // Disable close buttons during installation
            closeBtn.style.display = 'none';
            cancelBtn.textContent = 'Installing...';
            cancelBtn.disabled = true;
            cancelBtn.classList.add('opacity-50', 'cursor-not-allowed');
            
            // Show modal
            modal.classList.remove('hidden');
        }
        
        // Close installation modal
        function closeInstallModal() {
            const modal = document.getElementById('install-modal');
            const closeBtn = document.getElementById('install-close-btn');
            const cancelBtn = document.getElementById('install-cancel-btn');
            
            // Re-enable close buttons
            closeBtn.style.display = 'block';
            cancelBtn.textContent = 'Close';
            cancelBtn.disabled = false;
            cancelBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            
            // Hide modal
            modal.classList.add('hidden');
        }
        
        // Add installation output to terminal
        function addInstallOutput(message, type = 'info') {
            const output = document.getElementById('install-output');
            const timestamp = new Date().toLocaleTimeString();
            
            let colorClass = 'text-green-400';
            let prefix = '';
            
            if (type === 'error') {
                colorClass = 'text-red-400';
                prefix = '❌ ';
            } else if (type === 'warning') {
                colorClass = 'text-yellow-400';
                prefix = '⚠️  ';
            } else if (type === 'success') {
                colorClass = 'text-blue-400';
                prefix = '✅ ';
            } else if (type === 'command') {
                colorClass = 'text-cyan-400 font-bold';
                prefix = '➤ ';
            } else {
                colorClass = 'text-green-400';
                prefix = '  ';
            }
            
            const line = document.createElement('div');
            line.className = `${colorClass} mb-1 leading-relaxed`;
            
            if (type === 'command') {
                line.innerHTML = `<span class="text-gray-500">[${timestamp}]</span> ${prefix}<span class="text-cyan-300">${message}</span>`;
            } else {
                line.innerHTML = `<span class="text-gray-500">[${timestamp}]</span> ${prefix}<span>${message}</span>`;
            }
            
            output.appendChild(line);
            
            // Auto-scroll to bottom with smooth behavior
            const terminal = document.getElementById('install-terminal');
            terminal.scrollTop = terminal.scrollHeight;
        }
        
        // Update installation progress
        function updateInstallProgress(step, total, status, percentage) {
            console.log('updateInstallProgress called with:', { step, total, status, percentage });
            const statusElement = document.getElementById('install-status');
            const stepElement = document.getElementById('install-step');
            const progressBar = document.getElementById('install-progress-bar');
            
            if (statusElement) {
                statusElement.textContent = status;
                console.log('Updated status to:', status);
            } else {
                console.error('install-status element not found');
            }
            
            if (stepElement) {
                stepElement.textContent = `${step}/${total}`;
                console.log('Updated step to:', `${step}/${total}`);
            } else {
                console.error('install-step element not found');
            }
            
            if (progressBar) {
                progressBar.style.width = `${percentage}%`;
                console.log('Updated progress bar to:', `${percentage}%`);
            } else {
                console.error('install-progress-bar element not found');
            }
        }

        // Fungsi untuk menguninstall layanan
        async function uninstallService(service) {
            if (!(await showConfirm(`Apakah Anda yakin ingin menguninstall ${service}? Semua data dan konfigurasi akan dihapus!`, 'Konfirmasi Uninstall'))) {
                return;
            }

            try {
                showNotification(`Memulai uninstall ${service}...`, 'info');
                
                const response = await fetch(`/api/service/${service}/uninstall`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.success) {
                    showNotification(`${service} berhasil diuninstall!`, 'success');
                    updateServiceStatus();
                } else {
                    showNotification(`Gagal menguninstall ${service}: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification(`Terjadi kesalahan saat menguninstall ${service}`, 'error');
            }
        }

        // Fungsi untuk memperbarui status layanan
        async function updateServiceStatus() {
            try {
                const response = await fetch('/api/services/status');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                
                // Update status Nginx
                const nginxStatus = document.getElementById('nginx-status');
                const nginxButtons = document.querySelector('#nginx-buttons');
                if (nginxStatus && nginxButtons) {
                    if (data.nginx.installed) {
                        nginxStatus.textContent = `Status: ${data.nginx.running ? 'Berjalan' : 'Berhenti'} | Version: ${data.nginx.version} | PID: ${data.nginx.pid || 'N/A'}`;
                        nginxStatus.className = `text-sm ${data.nginx.running ? 'text-green-600' : 'text-red-600'}`;
                        nginxButtons.innerHTML = `
                            <button onclick="startService('nginx')" class="px-3 py-1 text-sm font-medium text-white bg-green-600 rounded hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">Start</button>
                            <button onclick="stopService('nginx')" class="px-3 py-1 text-sm font-medium text-white bg-red-600 rounded hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">Stop</button>
                            <button onclick="uninstallService('nginx')" class="px-3 py-1 text-sm font-medium text-white bg-orange-600 rounded hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500">Uninstall</button>
                        `;
                    } else {
                        nginxStatus.textContent = 'Status: Tidak Terinstall';
                        nginxStatus.className = 'text-sm text-gray-500';
                        nginxButtons.innerHTML = `
                            <button onclick="installService('nginx')" class="px-3 py-1 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Install Nginx</button>
                        `;
                    }
                }

                // Update status PHP-FPM
                const phpStatus = document.getElementById('php-status');
                const phpButtons = document.querySelector('#php-buttons');
                if (phpStatus && phpButtons) {
                    if (data.php_fpm.installed) {
                        phpStatus.textContent = `Status: ${data.php_fpm.running ? 'Berjalan' : 'Berhenti'} | Version: ${data.php_fpm.version} | PID: ${data.php_fpm.pid || 'N/A'}`;
                        phpStatus.className = `text-sm ${data.php_fpm.running ? 'text-green-600' : 'text-red-600'}`;
                        phpButtons.innerHTML = `
                            <button onclick="startService('php-fpm')" class="px-3 py-1 text-sm font-medium text-white bg-green-600 rounded hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">Start</button>
                            <button onclick="stopService('php-fpm')" class="px-3 py-1 text-sm font-medium text-white bg-red-600 rounded hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">Stop</button>
                            <button onclick="uninstallService('php-fpm')" class="px-3 py-1 text-sm font-medium text-white bg-orange-600 rounded hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500">Uninstall</button>
                        `;
                    } else {
                        phpStatus.textContent = 'Status: Tidak Terinstall';
                        phpStatus.className = 'text-sm text-gray-500';
                        phpButtons.innerHTML = `
                            <button onclick="installService('php-fpm')" class="px-3 py-1 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Install PHP-FPM</button>
                        `;
                    }
                }

                // Update status MySQL
                const mysqlStatus = document.getElementById('mysql-status');
                const mysqlButtons = document.querySelector('#mysql-buttons');
                if (mysqlStatus && mysqlButtons) {
                    if (data.mysql.installed) {
                        mysqlStatus.textContent = `Status: ${data.mysql.running ? 'Berjalan' : 'Berhenti'} | Version: ${data.mysql.version} | PID: ${data.mysql.pid || 'N/A'}`;
                        mysqlStatus.className = `text-sm ${data.mysql.running ? 'text-green-600' : 'text-red-600'}`;
                        mysqlButtons.innerHTML = `
                            <button onclick="startService('mysql')" class="px-3 py-1 text-sm font-medium text-white bg-green-600 rounded hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">Start</button>
                            <button onclick="stopService('mysql')" class="px-3 py-1 text-sm font-medium text-white bg-red-600 rounded hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">Stop</button>
                            <button onclick="uninstallService('mysql')" class="px-3 py-1 text-sm font-medium text-white bg-orange-600 rounded hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500">Uninstall</button>
                        `;
                    } else {
                        mysqlStatus.textContent = 'Status: Tidak Terinstall';
                        mysqlStatus.className = 'text-sm text-gray-500';
                        mysqlButtons.innerHTML = `
                            <button onclick="installService('mysql')" class="px-3 py-1 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Install MySQL</button>
                        `;
                    }
                }
            } catch (error) {
                console.error('Error updating service status:', error);
                // Set status to error state
                ['nginx-status', 'php-status', 'mysql-status'].forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = 'Error: Tidak dapat memuat status';
                        element.className = 'text-sm text-red-600';
                    }
                });
            }
        }

        // Fungsi untuk restart aplikasi Flask
        async function restartApp() {
            if (!(await showConfirm('Apakah Anda yakin ingin restart aplikasi? Koneksi akan terputus sementara.', 'Konfirmasi Restart'))) {
                return;
            }

            try {
                showNotification('Memulai restart aplikasi...', 'info');
                
                const response = await fetch('/api/app/restart', {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Aplikasi berhasil direstart! Halaman akan dimuat ulang dalam 3 detik...', 'success');
                    
                    // Reload halaman setelah 3 detik
                    setTimeout(() => {
                        window.location.reload();
                    }, 3000);
                } else {
                    showNotification(`Gagal restart aplikasi: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Terjadi kesalahan saat restart aplikasi', 'error');
            }
        }

        // Perbarui status setiap 10 detik
        updateServiceStatus();
        setInterval(updateServiceStatus, 10000);

        // MariaDB Config Editor Functions
        async function editMariaDBConfig() {
            try {
                const response = await fetch('/api/mariadb/config');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('mariadb-config-content').value = data.content;
                    document.getElementById('mariadb-config-modal').classList.remove('hidden');
                } else {
                    showNotification(`Gagal membaca konfigurasi: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Terjadi kesalahan saat membaca konfigurasi MariaDB', 'error');
            }
        }

        function closeMariaDBConfigModal() {
            document.getElementById('mariadb-config-modal').classList.add('hidden');
        }

        async function saveMariaDBConfig() {
            try {
                const content = document.getElementById('mariadb-config-content').value;
                
                const response = await fetch('/api/mariadb/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ content: content })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Konfigurasi MariaDB berhasil disimpan!', 'success');
                    closeMariaDBConfigModal();
                } else {
                    showNotification(`Gagal menyimpan konfigurasi: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Terjadi kesalahan saat menyimpan konfigurasi MariaDB', 'error');
            }
        }

        // Nginx Config Functions
        async function editNginxConfig() {
            try {
                const response = await fetch('/api/nginx/config');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('nginx-config-content').value = data.content;
                    document.getElementById('nginx-config-modal').classList.remove('hidden');
                } else {
                    showNotification(`Gagal memuat konfigurasi: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Terjadi kesalahan saat memuat konfigurasi Nginx', 'error');
            }
        }

        function closeNginxConfigModal() {
            document.getElementById('nginx-config-modal').classList.add('hidden');
        }

        async function saveNginxConfig() {
            try {
                const content = document.getElementById('nginx-config-content').value;
                const response = await fetch('/api/nginx/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ content: content })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Konfigurasi Nginx berhasil disimpan', 'success');
                    closeNginxConfigModal();
                } else {
                    showNotification(`Gagal menyimpan konfigurasi: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Terjadi kesalahan saat menyimpan konfigurasi Nginx', 'error');
            }
        }

        // Install Certbot Function
        async function installCertbot() {
            if (!(await showConfirm('Are you sure you want to install Certbot? This will run: apt install certbot python3-certbot-nginx -y', 'Install Certbot'))) return;

            // Show installation modal
            showInstallModal('Certbot');
            
            // Update progress
            updateInstallProgress('Memulai instalasi Certbot...', '1/3', 10);
            addInstallOutput('Starting Certbot installation...', 'info');
            addInstallOutput('apt update && apt install certbot python3-certbot-nginx -y', 'command');

            try {
                // Connect to WebSocket for real-time output
                const socket = io();
                
                socket.on('certbot_install_output', function(data) {
                    addInstallOutput(data.message, data.type || 'info');
                });
                
                socket.on('certbot_install_progress', function(data) {
                    updateCertbotProgress(data.status, data.step, data.progress);
                });
                
                socket.on('certbot_install_complete', function(data) {
                    if (data.success) {
                        addInstallOutput('Certbot installation completed successfully!', 'success');
                        updateCertbotProgress('Installation completed', '3/3', 100);
                        showNotification('Certbot installed successfully!', 'success');
                    } else {
                        addInstallOutput(`Installation failed: ${data.error}`, 'error');
                        updateCertbotProgress('Installation failed', '3/3', 100);
                        showNotification(data.error || 'Failed to install Certbot', 'error');
                    }
                    
                    // Re-enable close button
                    const closeBtn = document.getElementById('install-close-btn');
                    const cancelBtn = document.getElementById('install-cancel-btn');
                    closeBtn.style.display = 'block';
                    cancelBtn.textContent = 'Close';
                    cancelBtn.disabled = false;
                    cancelBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    
                    socket.disconnect();
                });
                
                const response = await fetch('/api/certbot/install', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    const data = await response.json();
                    addInstallOutput(`Installation failed: ${data.error}`, 'error');
                    updateInstallProgress('Installation failed', '3/3', 100);
                    showNotification(data.error || 'Failed to install Certbot', 'error');
                    
                    // Re-enable close button
                    const closeBtn = document.getElementById('install-close-btn');
                    const cancelBtn = document.getElementById('install-cancel-btn');
                    closeBtn.style.display = 'block';
                    cancelBtn.textContent = 'Close';
                    cancelBtn.disabled = false;
                    cancelBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
                
            } catch (error) {
                console.error('Error installing Certbot:', error);
                addInstallOutput(`Installation error: ${error.message}`, 'error');
                updateCertbotProgress('Installation failed', '3/3', 100);
                showNotification('Failed to install Certbot. Please try again.', 'error');
                
                // Re-enable close button
                const closeBtn = document.getElementById('install-close-btn');
                const cancelBtn = document.getElementById('install-cancel-btn');
                closeBtn.style.display = 'block';
                cancelBtn.textContent = 'Close';
                cancelBtn.disabled = false;
                cancelBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }
        
        // Update installation progress for certbot (different parameter order)
        function updateCertbotProgress(status, step, progress) {
            const statusElement = document.getElementById('install-status');
            const stepElement = document.getElementById('install-step');
            const progressBar = document.getElementById('install-progress-bar');
            
            if (statusElement) statusElement.textContent = status;
            if (stepElement) stepElement.textContent = step;
            if (progressBar) progressBar.style.width = `${progress}%`;
        }
    </script>

    <!-- MariaDB Config Modal -->
    <div id="mariadb-config-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white dark:bg-gray-800">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">Edit MariaDB Configuration</h3>
                    <button onclick="closeMariaDBConfigModal()" class="text-gray-400 hover:text-gray-600 dark:text-gray-300 dark:hover:text-gray-100">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">File: /etc/mysql/mariadb.conf.d/50-server.cnf</label>
                    <textarea id="mariadb-config-content" rows="20" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 font-mono text-sm" placeholder="Loading configuration..."></textarea>
                </div>
                <div class="flex justify-end space-x-3">
                    <button onclick="closeMariaDBConfigModal()" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-600 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                        Cancel
                    </button>
                    <button onclick="saveMariaDBConfig()" class="px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        Save Configuration
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Installation Progress Modal -->
    <div id="install-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-[60]">
        <div class="relative top-10 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-2/3 xl:w-1/2 shadow-lg rounded-md bg-white dark:bg-gray-800">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white" id="install-modal-title">Installing Service</h3>
                    <button onclick="closeInstallModal()" class="text-gray-400 hover:text-gray-600 dark:text-gray-300 dark:hover:text-gray-100" id="install-close-btn">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- Terminal-style output -->
                <div class="mb-4">
                    <div class="bg-black dark:bg-gray-900 rounded-lg p-4 h-80 overflow-y-auto font-mono text-sm" id="install-terminal">
                        <div class="text-green-400" id="install-output">
                            <!-- Installation output will appear here -->
                        </div>
                    </div>
                </div>
                
                <!-- Progress indicator -->
                <div class="mb-4">
                    <div class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-300 mb-2">
                        <span id="install-status">Memulai instalasi...</span>
                        <span id="install-step">0/4</span>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                        <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%" id="install-progress-bar"></div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button onclick="closeInstallModal()" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-600 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500" id="install-cancel-btn">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Nginx Config Modal -->
    <div id="nginx-config-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white dark:bg-gray-800">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">Edit Nginx Configuration</h3>
                    <button onclick="closeNginxConfigModal()" class="text-gray-400 hover:text-gray-600 dark:text-gray-300 dark:hover:text-gray-100">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">File: /etc/nginx/nginx.conf</label>
                    <textarea id="nginx-config-content" rows="20" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 font-mono text-sm" placeholder="Loading configuration..."></textarea>
                </div>
                <div class="flex justify-end space-x-3">
                    <button onclick="closeNginxConfigModal()" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-600 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                        Cancel
                    </button>
                    <button onclick="saveNginxConfig()" class="px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        Save Configuration
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Virtual Host Settings Modal -->
    <div id="vhost-settings-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white dark:bg-gray-800">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">Virtual Host Settings</h3>
                    <button onclick="closeVHostSettingsModal()" class="text-gray-400 hover:text-gray-600 dark:text-gray-300 dark:hover:text-gray-100">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- Tab Navigation -->
                <div class="border-b border-gray-200 dark:border-gray-600 mb-4">
                    <nav class="-mb-px flex space-x-8">
                        <button onclick="switchVHostTab('domain')" id="tab-domain" class="vhost-tab-btn py-2 px-1 border-b-2 border-blue-500 font-medium text-sm text-blue-600 dark:text-blue-400 whitespace-nowrap">
                            Domain
                        </button>
                        <button onclick="switchVHostTab('rewrite')" id="tab-rewrite" class="vhost-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 whitespace-nowrap">
                            Rewrite
                        </button>
                        <button onclick="switchVHostTab('default')" id="tab-default" class="vhost-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 whitespace-nowrap">
                            Default
                        </button>
                        <button onclick="switchVHostTab('config')" id="tab-config" class="vhost-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 whitespace-nowrap">
                            Config
                        </button>
                        <button onclick="switchVHostTab('ssl')" id="tab-ssl" class="vhost-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 whitespace-nowrap">
                            SSL
                        </button>
                        <button onclick="switchVHostTab('php')" id="tab-php" class="vhost-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 whitespace-nowrap">
                            PHP Version
                        </button>
                        <button onclick="switchVHostTab('proxy')" id="tab-proxy" class="vhost-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 whitespace-nowrap">
                            Proxy
                        </button>
                    </nav>
                </div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Domain Tab -->
                    <div id="content-domain" class="vhost-tab-content space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Domain</label>
                            <input type="text" id="vhost-domain" readonly class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm bg-gray-100 dark:bg-gray-600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Root Directory</label>
                            <input type="text" id="vhost-root-dir" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Status</label>
                            <select id="vhost-status" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="true">Enabled</option>
                                <option value="false">Disabled</option>
                            </select>
                        </div>
                    </div>

                    <!-- Rewrite Tab -->
                    <div id="content-rewrite" class="vhost-tab-content space-y-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Rewrite Rules</label>
                            <textarea id="vhost-rewrite-rules" rows="8" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 font-mono text-sm" placeholder="# Add rewrite rules here...\n# Example:\n# rewrite ^/old-url$ /new-url permanent;"></textarea>
                        </div>
                        <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4">
                            <h4 class="text-sm font-medium text-blue-800 dark:text-blue-200 mb-2">Common Rewrite Examples:</h4>
                            <ul class="text-xs text-blue-700 dark:text-blue-300 space-y-1">
                                <li>• WordPress: <code>try_files $uri $uri/ /index.php?$args;</code></li>
                                <li>• Laravel: <code>try_files $uri $uri/ /index.php?$query_string;</code></li>
                                <li>• Redirect: <code>rewrite ^/old$ /new permanent;</code></li>
                            </ul>
                        </div>
                    </div>

                    <!-- Default Tab -->
                    <div id="content-default" class="vhost-tab-content space-y-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Default Index Files</label>
                            <input type="text" id="vhost-index-files" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="index.php index.html index.htm" value="index.php index.html index.htm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Error Pages</label>
                            <div class="space-y-2">
                                <input type="text" id="vhost-error-404" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="404 Error Page (e.g., /404.html)">
                                <input type="text" id="vhost-error-500" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="500 Error Page (e.g., /500.html)">
                            </div>
                        </div>
                    </div>

                    <!-- Config Tab -->
                    <div id="content-config" class="vhost-tab-content space-y-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Nginx Configuration</label>
                            <div class="mb-2 text-xs text-gray-500 dark:text-gray-400">
                                Config file: /etc/nginx/sites-available/<span id="config-filename"></span>
                            </div>
                            <textarea id="vhost-custom-config" rows="12" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 font-mono text-sm" placeholder="Loading configuration..."></textarea>
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">
                            <strong>Note:</strong> Changes will be saved to the configuration file when you click "Save Settings".
                        </div>
                    </div>

                    <!-- SSL Tab -->
                    <div id="content-ssl" class="vhost-tab-content space-y-4 hidden">
                        <div class="flex items-center space-x-3 mb-4">
                            <input type="checkbox" id="vhost-ssl" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                            <label for="vhost-ssl" class="text-sm font-medium text-gray-700 dark:text-gray-300">Enable SSL/HTTPS</label>
                        </div>
                        
                        <!-- Let's Encrypt Section -->
                        <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 mb-4">
                            <h4 class="text-sm font-medium text-green-800 dark:text-green-200 mb-3">Let's Encrypt SSL Certificate</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email Address</label>
                                    <input type="email" id="vhost-letsencrypt-email" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500" placeholder="your-email@example.com">
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Required for Let's Encrypt certificate registration and renewal notifications</p>
                                </div>
                                <button type="button" onclick="generateLetsEncryptSSL()" class="w-full px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                    <span class="flex items-center justify-center">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                        </svg>
                                        Generate Let's Encrypt SSL
                                    </span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Manual SSL Section -->
                        <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Manual SSL Certificate</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">SSL Certificate Path</label>
                                    <input type="text" id="vhost-ssl-cert" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="/path/to/certificate.crt">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">SSL Private Key Path</label>
                                    <input type="text" id="vhost-ssl-key" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="/path/to/private.key">
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" id="vhost-force-https" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                            <label for="vhost-force-https" class="text-sm text-gray-700 dark:text-gray-300">Force HTTPS (Redirect HTTP to HTTPS)</label>
                        </div>
                    </div>

                    <!-- PHP Version Tab -->
                    <div id="content-php" class="vhost-tab-content space-y-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">PHP Version</label>
                            <select id="vhost-php-version" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="8.1">PHP 8.1</option>
                                <option value="8.0">PHP 8.0</option>
                                <option value="7.4">PHP 7.4</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">PHP-FPM Socket</label>
                            <input type="text" id="vhost-php-socket" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="unix:/var/run/php/php8.1-fpm.sock" value="unix:/var/run/php/php8.1-fpm.sock">
                        </div>
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" id="vhost-php-enabled" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" checked>
                            <label for="vhost-php-enabled" class="text-sm text-gray-700 dark:text-gray-300">Enable PHP Processing</label>
                        </div>
                    </div>

                    <!-- Proxy Tab -->
                    <div id="content-proxy" class="vhost-tab-content space-y-4 hidden">
                        <div class="flex items-center space-x-3 mb-4">
                            <input type="checkbox" id="vhost-proxy-enabled" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                            <label for="vhost-proxy-enabled" class="text-sm font-medium text-gray-700 dark:text-gray-300">Enable Reverse Proxy</label>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Proxy Pass URL</label>
                            <input type="text" id="vhost-proxy-pass" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="http://localhost:3000">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Proxy Headers</label>
                            <textarea id="vhost-proxy-headers" rows="6" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 font-mono text-sm" placeholder="proxy_set_header Host $host;\nproxy_set_header X-Real-IP $remote_addr;\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\nproxy_set_header X-Forwarded-Proto $scheme;"></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button onclick="closeVHostSettingsModal()" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-600 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                        Cancel
                    </button>
                    <button onclick="saveVHostSettings()" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Save Settings
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Helper function to show custom alert modal
        function showAlert(message, title = 'Pemberitahuan') {
            return new Promise((resolve) => {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50';
                modal.innerHTML = `
                    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-gray-800">
                        <div class="mt-3 text-center">
                            <h3 class="text-lg font-medium text-gray-900 dark:text-white">${title}</h3>
                            <div class="mt-4">
                                <p class="text-sm text-gray-600 dark:text-gray-300">${message}</p>
                            </div>
                            <div class="flex justify-center mt-6">
                                <button id="alertOkBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">OK</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                const handleOk = () => {
                    document.body.removeChild(modal);
                    resolve();
                };
                
                document.getElementById('alertOkBtn').addEventListener('click', handleOk);
                modal.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === 'Escape') {
                        handleOk();
                    }
                });
            });
        }

        // Helper function to show custom confirm modal
        function showConfirm(message, title = 'Konfirmasi') {
            return new Promise((resolve) => {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50';
                modal.innerHTML = `
                    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-gray-800">
                        <div class="mt-3 text-center">
                            <h3 class="text-lg font-medium text-gray-900 dark:text-white">${title}</h3>
                            <div class="mt-4">
                                <p class="text-sm text-gray-600 dark:text-gray-300">${message}</p>
                            </div>
                            <div class="flex justify-center space-x-3 mt-6">
                                <button id="confirmCancelBtn" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-400 dark:hover:bg-gray-500">Batal</button>
                                <button id="confirmOkBtn" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">Ya</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                const handleOk = () => {
                    document.body.removeChild(modal);
                    resolve(true);
                };
                
                const handleCancel = () => {
                    document.body.removeChild(modal);
                    resolve(false);
                };
                
                document.getElementById('confirmOkBtn').addEventListener('click', handleOk);
                document.getElementById('confirmCancelBtn').addEventListener('click', handleCancel);
                
                modal.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        handleOk();
                    } else if (e.key === 'Escape') {
                        handleCancel();
                    }
                });
            });
        }

        // Helper function to show custom prompt modal
        function showPrompt(message, defaultValue = '', title = 'Input') {
            return new Promise((resolve) => {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50';
                modal.innerHTML = `
                    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-gray-800">
                        <div class="mt-3 text-center">
                            <h3 class="text-lg font-medium text-gray-900 dark:text-white">${title}</h3>
                            <div class="mt-4">
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">${message}</p>
                                <input type="text" id="promptInput" 
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                       value="${defaultValue}">
                            </div>
                            <div class="flex justify-center space-x-3 mt-6">
                                <button id="promptCancelBtn" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-400 dark:hover:bg-gray-500">Batal</button>
                                <button id="promptOkBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">OK</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                const input = document.getElementById('promptInput');
                input.focus();
                input.select();
                
                const handleOk = () => {
                    const value = input.value;
                    document.body.removeChild(modal);
                    resolve(value);
                };
                
                const handleCancel = () => {
                    document.body.removeChild(modal);
                    resolve(null);
                };
                
                document.getElementById('promptOkBtn').addEventListener('click', handleOk);
                document.getElementById('promptCancelBtn').addEventListener('click', handleCancel);
                
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        handleOk();
                    }
                });
                
                modal.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        handleCancel();
                    }
                });
            });
        }

        // Handle window resize for charts
        window.addEventListener('resize', () => {
            if (realtimeChart) realtimeChart.resize();
            if (systemRealtimeChart) systemRealtimeChart.resize();
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', (event) => {
            const themeDropdown = document.getElementById('theme-dropdown-menu');
            const themeButton = document.getElementById('theme-toggle');
            
            if (themeButton && themeDropdown && !themeButton.contains(event.target) && !themeDropdown.contains(event.target)) {
                themeDropdown.classList.add('hidden');
            }
        });
    </script>
</body>
</html>